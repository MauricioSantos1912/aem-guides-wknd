(function(f,e,h){function d(b,c,g){b={element:h(b).is("coral-shell-header-home")?"logo":" close",feature:"globalnav",type:"toggleable",action:g,widget:{name:"globalnav",type:"toggleable"},attributes:{}};h(f).adaptTo("foundation-tracker").trackEvent(b)}h(e).on("click",".globalnav-toggle",function(b){b.preventDefault();var c=e.getElementById("globalnav-overlay");if(c)d(this,b,"hide"),c.hide();else{d(this,b,"show");b=e.getElementsByClassName("globalnav-navigator-backbutton");c=f.location.pathname;if(b&&
b.length&&b[0].hidden&&c.includes("/aem/start")&&(b=e.getElementById("globalnav-start-home-collection"))&&(b=b.closest("coral-panel"))&&b.selected)return;b=this.dataset.globalnavToggleHref;if(Granite.UI.Foundation.XSS.isSameOrigin(b)){var g=h(f).adaptTo("foundation-ui");g.wait();h.ajax({url:b,cache:!1,success:function(q){q=Granite.UI.Foundation.XSS.sanitizeHtml(q);var r=h(q).get(0),y=h(r);h("coral-shell").append(r);h("#globalNavHeader").attr("aria-expanded",!0);y.trigger("foundation-contentloaded");
y.on("coral-overlay:close",function(l){l.target===r&&(y.remove(),h("#globalNavHeader").attr("aria-expanded",!1))});Coral.commons.ready(r,function(){g.clearWait();r.open=!0;var l=y.find(".globalnav-activeconsole").first();l.length&&(l.is(".foundation-collection-navigator.globalnav-homecard")?l.trigger("click"):l.is(".globalnav-tools-navigation-item")&&l.prop("active",!0),setTimeout(function(){l.closest("coral-panel").attr("selected","")},0))})},error:function(){g.clearWait()}})}}});h(e).on("click",
".globalnav-anchor",function(b){var c=h(this);if(b=c.data("globalnav-anchor-href"))c=c.data("globalnav-anchor-target")||"_self","single"===(h(f).adaptTo("foundation-preference").get("winMode")||"multi")&&(c="_self"),"null"!==(new URL(b,e.baseURI)).origin&&f.open(b,c)});h(e).on("foundation-collection-navigate",".foundation-collection",function(b){var c=h(this);h(".granite-collection-navigator.globalnav-navigator").each(function(){if(c.is(this.dataset.graniteCollectionNavigatorTarget)){var g=h(this).prev(".globalnav-navigator-backbutton");
g[0].label.textContent=this.selectedItem.textContent;h(this.selectedItem).next("betty-breadcrumbs-item").length?g.removeAttr("hidden"):g.attr("hidden","")}})});h(e).on("click",".globalnav-navigator-backbutton",function(b){b=h(this).next("betty-breadcrumbs.globalnav-navigator");h(b.prop("selectedItem")).next("betty-breadcrumbs-item").prop("selected",!0);var c=e.createEvent("HTMLEvents");c.initEvent("change",!0,!1);b[0].dispatchEvent(c)});h(e).on("coral-columnview:activeitemchange",".globalnav-tools-navigation",
function(b){b=b.originalEvent.detail.activeItem;h(this).find(".foundation-selections-item").removeClass("foundation-selections-item");b.classList.add("foundation-selections-item");h(this).trigger("foundation-selections-change")});h(e).on("coral-collection:add","#globalnav-start-home-collection,#globalnav-home-collection,#globalnav-start-tools-content-collection,#globalnav-tools-content-collection",function(b){var c=b.originalEvent.detail.item;Coral.commons.nextFrame(function(){c.removeAttribute("aria-selected")})});
h(e).on("keydown","#globalnav-start-home-collection .foundation-collection-item,#globalnav-home-collection .foundation-collection-item,#globalnav-start-tools-content-collection .foundation-collection-item,#globalnav-tools-content-collection .foundation-collection-item",function(b){if(32===b.keyCode){b.preventDefault();var c=b.target;c.selected=!1;Coral.commons.nextFrame(function(){c.removeAttribute("aria-selected");c.tabIndex=-1})}});h(e).on("focus","coral-masonry-item.foundation-collection-item",
function(b){var c=b.target;c.contains(b.relatedTarget)||(h(c).find(".globalnav-homecard, .globalnav-toolcard").focus(),Coral.commons.nextFrame(function(){c!==e.activeElement&&(c.tabIndex=-1)}))});h(e).on("keydown",".globalnav-homecard, .globalnav-toolcard",function(b){switch(b.keyCode){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 72:case 74:case 75:case 76:var c=h(b.target).closest("coral-masonry-item.foundation-collection-item"),g=e.createEvent("Event");g.initEvent("keydown",
!0,!0);g.key=b.key;g.keyCode=b.keyCode;g.which=b.which;g.key=b.key;g.shiftKey=b.shiftKey;g.ctrlKey=b.ctrlKey;g.metaKey=b.metaKey;c[0].dispatchEvent(g);break;case 13:case 32:b.preventDefault(),b.target.click()}})})(window,document,Granite.$);
(function(f,e){function h(l,H,t,v){return l.find(function(x){if(t&&v){if(!x.name.startsWith(H+"."))return!1;x=x.name.substring((H+".").length);return y.exec(x)[2]===t}return x.name===H+(t?"."+t:"")})}function d(){var l=e(".granite-omnisearch-predicates");e(".granite-omnisearch-facet-count",l).remove();e(".granite-omnisearch-facet-labelcount",l).remove()}function b(l,H){var t=e(".granite-omnisearch-predicates coral-accordion-item-content"),v=e();v=v.add(t.find("coral-checkbox").not("coral-accordion-item-label *"));
v=v.add(t.find("coral-radio").not("coral-accordion-item-label *"));var x=e();l.forEach(function(A){a:switch(y.exec(A.predicate.split(".").pop())[2]){case "property":case "boolproperty":var M=r.property;break a;default:M=r["default"]}var I=v.filter("[name^\x3d'"+A.predicate+"']");I.each(function(E,S){E=e(S);E=E.add(E.closest("coral-accordion-item-content").children("input[name^\x3d'"+A.predicate+"']")).add(E.siblings("input[name^\x3d'"+A.predicate+"']")).toArray().map(function(z){return{name:z.name,
value:z.value}});E=M.getCount(A,E);null!==E&&((0<E.count||H.showAggregateCount)&&c(S,E.count,"granite-omnisearch-facet-count"),q.set(S,E))});x=x.add(I)});return x}function c(l,H,t){e(document.createElement("span")).addClass(t).text(" ("+H+")").appendTo(l.label)}function g(l,H){var t=l.toArray();H.showAggregateCount?e(".granite-omnisearch-predicates coral-accordion-item-label coral-checkbox").each(function(v,x){var A=e(x).closest("coral-accordion-item");v=t.filter(function(I){return 0<A.has(I).length});
if(v.length){var M=new Map;v=v.reduce(function(I,E){E=q.get(E);var S=0;null===E.key||M.has(E.key)||(M.set(E.key,!0),S=E.count);return I+S},0);c(x,v,"granite-omnisearch-facet-labelcount")}}):e(".granite-omnisearch-predicates coral-accordion-item").each(function(){var v=e(this);t.some(function(x){var A=q.get(x);return A&&0<A.count&&0<v.has(x).length})&&v.prop("selected",!0)})}var q=new WeakMap,r={"default":{getCount:function(l,H){var t=h(H,l.predicate);l=l.buckets.find(function(v){return t.value===
v.value});return{count:l?l.count:0,key:l?"equals--"+l.value:null}}},property:{getCount:function(l,H){var t=h(H,l.predicate,"value",!0);H=h(H,l.predicate,"operation");return H&&"equals"!==H.value?"exists"!==H.value||t&&"true"!==t.value?null:{count:l.buckets.reduce(function(v,x){return v+x.count},0),key:"exists--true"}:(l=l.buckets.find(function(v){return t.value===v.value}),{count:l?l.count:0,key:l?"equals--"+l.value:null})}}},y=/^(.+_)?(.+)$/;e(f).adaptTo("foundation-registry").register("foundation.adapters",
{type:"granite-omnisearch-internal-facets",selector:e(f),adapter:function(){return{updateCount:function(l,H){if(l){void 0===H.showAggregateCount&&(H.showAggregateCount=!0);var t=Object.keys(l).reduce(function(v,x){v.push({predicate:x,buckets:l[x]});return v},[]);d();t=b(t,H);g(t,H)}else d()}}}})})(window,Granite.$);
(function(f,e){function h(d){return Object.keys(d).find(function(b){b=b.split("_");return 1===b.length&&"fulltext"===b[0]||2===b.length&&"fulltext"===b[1]})}e(f).on("granite-omnisearch-predicate-update",function(d){d=d.detail.queryParameters;var b=h(d),c=f.querySelector(".granite-omnisearch-typeahead .granite-omnisearch-typeahead-input");b&&c&&(c.value=d[b])});e(f).on("granite-omnisearch-predicate-clear",function(d){d.detail.reset&&(d.target.querySelector(".granite-omnisearch-typeahead .granite-omnisearch-typeahead-input").value=
"")})})(document,Granite.$);
(function(f,e){function h(b){b=b?Granite.I18n.get("Location: {0} | AEM Search",b):Granite.I18n.get("AEM Search");var c=History.getState();History.replaceState(c.data,b)}function d(b,c,g,q){var r=f.querySelector(".granite-omnisearch-form").querySelector("#granite-omnisearch-field-location");if(!r||r.value!==b){r=g?g.dataset.graniteOmnisearchTypeaheadSuggestionTag:Granite.I18n.get("Location");g=g?g.dataset.graniteOmnisearchTypeaheadSuggestionValue:c;var y=f.querySelector(".granite-omnisearch-form"),l=
y.querySelector("#granite-omnisearch-field-location");null===l&&(l=f.createElement("input"),l.id="granite-omnisearch-field-location",l.type="hidden",l.name="location",y.appendChild(l));l.value=b;y=f.querySelector(".granite-omnisearch-form");l=y.querySelector("#granite-omnisearch-field-location-suggestion");null===l&&(l=f.createElement("input"),l.id="granite-omnisearch-field-location-suggestion",l.type="hidden",l.name="location.suggestion",y.appendChild(l));l.value=g;y=f.querySelector(".granite-omnisearch-form").querySelector(".granite-omnisearch-typeahead-tags");
l=y.querySelector("#granite-omnisearch-field-locationtag");null===l&&(l=new Coral.Tag,l.id="granite-omnisearch-field-locationtag",y.items.add(l));e(l.label).empty().append(e(f.createElement("span")).addClass("u-coral-text-capitalize u-coral-text-italic u-coral-text-secondary").text(r+": ")).append(e(f.createElement("span")).text(g));q&&(c={value:b,label:c},q=History.getState(),q.data.omnisearch=q.data.omnisearch||{},q.data.omnisearch.location=c,History.replaceState(q.data,q.title));e(f).trigger({type:"granite-shell-omnisearch-predicate-location:updated",
detail:{location:b}})}}e(f).on("granite-omnisearch-predicate-update",function(b){var c=b.detail.item;if(!c||"location"===c.dataset.graniteOmnisearchTypeaheadSuggestionPredicateid){var g=b.detail.queryParameters;b=g.location;g=g["location.suggestion"];b&&(h(b),d(b,g,c,!0))}});e(f).on("granite-shell-omnisearch-predicate-location:update",function(b){b.stopImmediatePropagation();d(b.detail.location,b.detail.locationSuggestion)});e(f).on("granite-omnisearch-predicate-clear",function(b){var c=b.target;
if((b=b.detail.item)&&b.matches("#granite-omnisearch-field-locationtag")){var g=c.querySelector("#granite-omnisearch-field-location");c=c.querySelector("#granite-omnisearch-field-location");g.remove();c.remove();b.remove();h();e(f).trigger("granite-shell-omnisearch-predicate-location:cleared")}})})(document,Granite.$);
(function(f,e,h,d,b){function c(z){return z.replace(/[.?*+^$[\]\\(){}|-]/g,"\\$\x26")}function g(z,D){return Object.keys(z).reduce(function(F,p){p=z[p];p.href&&p.title?F.push({title:D?D+" \u203a "+p.title:p.title,href:p.href,icon:p.icon}):"object"===typeof p&&(F=F.concat(g(p,D?D+" \u203a "+p.title:p.title)));return F},[])}function q(z){return function(D,F){if(z===D.suggestion)return-1;if(z===F.suggestion)return 1;var p=D.suggestion.toLowerCase().indexOf(z.toLowerCase()),C=F.suggestion.toLowerCase().indexOf(z.toLowerCase());
return p===C?-(F.suggestion.length-D.suggestion.length):p-C}}function r(z,D){var F=new RegExp(D.split(" ").map(function(p){return"(?\x3d.*"+p+")"}).join("")+".+","gi");return z.filter(function(p){return F.test(p.title)})}function y(z){var D;h.UI.Foundation.Utils.everyReverse(E.get("foundation.omnisearch.navigation.suggestions"),function(F){F.name===z&&(D=F.handler(D))});return D||null}function l(z,D,F,p){F=c(F);D=r(D||[],F);var C=z.predicateSuggestions&&0<z.predicateSuggestions.length?8:9;return D.filter(function(){return!(p++>=
C)})}function H(z,D,F,p){var C=c(F),K=new RegExp("("+C.split(" ").join("|")+")","gi");return l(z,D,F,p).map(function(O,X){var L=new e.SelectList.Item,P=h.HTTP.externalize(O.href);L.value=O.value;L.id="granite-omnisearch-suggestion-item-"+(p+X);L.content.innerHTML="\x3ccoral-icon size\x3d'S' icon\x3d'"+O.icon+"'\x3e\x3c/coral-icon\x3e\x3cspan class\x3d'granite-omnisearch-typeahead-suggestions-tip'\x3e"+h.I18n.get("Press Enter to navigate")+"\x3c/span\x3e"+h.I18n.get("Go to")+" "+O.title.replace(K,
"\x3cspan class\x3d'u-coral-text-secondary'\x3e$1\x3c/span\x3e");L.setAttribute("data-granite-omnisearch-typeahead-navigation","");L.setAttribute("data-granite-omnisearch-typeahead-navigation-href",P);return L})}function t(z,D,F){return(z&&z.predicateSuggestions?z.predicateSuggestions:[]).filter(function(){return!(9<=F++)})}function v(z,D,F){var p=c(D),C=new RegExp("("+p.split(" ").join("|")+")","gi");return t(z,D,F).map(function(K,O){var X=h.HTTP.externalize(K.href),L=new e.SelectList.Item;L.value=
K.value;L.id="granite-omnisearch-suggestion-item-"+(F+O);L.href=X;L.content.innerHTML="\x3cspan class\x3d'granite-omnisearch-typeahead-suggestions-tip'\x3e"+h.I18n.get("Press Tab to add")+"\x3c/span\x3e\x3ccoral-tag size\x3d'M'\x3e\x3cspan class\x3d'u-coral-text-capitalize u-coral-text-secondary u-coral-text-italic'\x3e"+K.type+" : \x3c/span\x3e"+K.value.replace(C,"\x3cspan class\x3d'u-coral-text-secondary'\x3e$1\x3c/span\x3e")+"\x3c/coral-tag\x3e";L.setAttribute("data-granite-omnisearch-typeahead-suggestion-predicateid",
K.typePath||""!==K.queryParameters.location?"location":K.type);L.setAttribute("data-granite-omnisearch-typeahead-suggestion-tag",K.type);L.setAttribute("data-granite-omnisearch-typeahead-suggestion-value",K.value);d(L).data("granite-omnisearch-typeahead-suggestion-queryparameters",K.queryParameters);return L})}function x(z,D,F){var p=[];z&&z.suggestions&&(D=q(D),p=z.suggestions,p=p.sort(D).filter(function(C,K,O){return!K||C.suggestion!==O[K-1].suggestion}));return p.filter(function(){return!(9<=F++)})}
function A(z,D,F){var p=c(D),C=new RegExp("("+p.split(" ").join("|")+")","gi");return x(z,D,F).map(function(K,O){var X=d("\x3cdiv\x3e").text(K.suggestion).html(),L=new e.SelectList.Item;L.value=K.value;L.id="granite-omnisearch-suggestion-item-"+(F+O);L.content.innerHTML=X.replace(C,"\x3cspan class\x3d'u-coral-text-secondary'\x3e$1\x3c/span\x3e");return L})}function M(){var z=f.querySelector(".granite-omnisearch-overlay").querySelector(".granite-omnisearch-form"),D=z.querySelector(".granite-omnisearch-typeahead");
return(D=b.expand(D.dataset.graniteOmnisearchTypeaheadSrc))?d.ajax({url:D,method:d(z).attr("method"),data:d(z).serialize()}).then(function(F){return F}):Promise.resolve([])}function I(z,D){var F=[];return Promise.all([S(),M()]).then(function(p){var C=y(z);C||(C=p[0]);return(p=p[1])?(F=F.concat(H(p,C,D,0)),F=F.concat(v(p,D,F.length)),F=F.concat(A(p,D,F.length))):[]}).catch(function(){return[]})}var E=d(window).adaptTo("foundation-registry"),S=function(){var z;return function(){if(!z){var D=f.querySelector(".granite-omnisearch-overlay").dataset.graniteOmnisearchOverlayNavsrc;
return d.get(D).then(function(F){return z=g(F)})}return Promise.resolve(z)}}();E.register("foundation.adapters",{type:"granite-shell-omnisearch-suggestions",selector:d(window),adapter:function(){return{getSuggestions:function(z,D){return D?M(z,D):Promise.resolve([])},getWrappedSuggestions:function(z,D){return D?I(z,D):Promise.resolve([])}}}})})(document,Coral,Granite,Granite.$,Granite.URITemplate);
(function(f,e,h,d,b){function c(){var a=m.elements.input;a&&window.requestAnimationFrame(function(){a.focus()})}function g(){var a=d(m.elements.form).serializeArray().find(function(k){return"location"===k.name});return a?a.value:void 0}function q(a){if(a&&a.collection)return a.collection.index||null;a=History.getState();return a.data&&a.data.omnisearch&&a.data.omnisearch.collection?a.data.omnisearch.collection.index||null:null}function r(a,k){if(a&&k&&f.body.contains(a)&&f.body.contains(k)){var w=
d(a).position();w.top+a.offsetHeight>=k.offsetHeight?(a=a.offsetTop+a.offsetHeight-k.offsetHeight,k.scrollTop=a):0>w.top&&(a=a.offsetTop,k.scrollTop=a)}}function y(){var a=m.elements.input;if(a){if("selectionStart"in a)return a.selectionStart;if(f.selection){if(f.activeElement!==a)return-1;var k=f.selection.createRange(),w=k.text.length;k.moveStart("character",-a.value.length);return k.text.length-w}}else return-1}function l(){e.commons.nextFrame(function(){var a=m.elements.input,k=m.elements.tagList,
w=m.elements.tagListHolder,n=m.elements.tagListHolderList,u=m.elements.tagListHolderLabel,B=m.elements.tagListHolderPopover;if(a&&k)if(200>=a.clientWidth-k.offsetWidth){if(a=k.querySelector("coral-tag:not([name\x3d'location']):not([hidden])"))u.textContent=Number(u.textContent)+1,n=n.items.add({type:"button",content:{innerHTML:a.label.innerHTML+"\x3ccoral-icon class\x3d'granite-omnisearch-typeahead-tags-holder-list-remove' icon\x3d'closeCircle' size\x3d'XS'\x3e\x3c/coral-icon\x3e"}}),d(n).data("graniteOmnisearchTagsHolderItemTag",
{tag:a,width:a.getBoundingClientRect().width}),w.closable=!1,w.hidden=!1,a.hidden=!0}else{var G=n.items.last();if(G){var R=d(G).data("graniteOmnisearchTagsHolderItemTag");R&&R.tag.hidden&&200<a.clientWidth-k.offsetWidth-R.width&&(R.tag.hidden=!1,n.items.remove(G),n.items.length?u.textContent=Number(u.textContent)-1:(B.open=!1,w.hidden=!0,u.textContent=""))}d(a).css("padding-left",k.offsetWidth+36)}})}function H(a){var k=f.querySelector(".granite-shell-header");k&&(k.style.visibility=a?"hidden":"")}
function t(a){var k=m.elements.input,w=m.elements.selectList;k.setAttribute("aria-expanded",!0);k.setAttribute("aria-controls",w.id);k.setAttribute("aria-activedescendant",a.id);a.setAttribute("aria-live","polite");w.setAttribute("aria-label",h.I18n.get("AEM Search")+": "+k.value)}function v(){var a=m.elements.input,k=m.elements.selectList;a.setAttribute("aria-expanded",!1);a.removeAttribute("aria-controls");a.removeAttribute("aria-activedescendant");k.setAttribute("aria-label",h.I18n.get("AEM Search"))}
function x(a){if(a.dataset.graniteOmnisearchTypeaheadSuggestionPredicateid){a.dataset.graniteOmnisearchTypeaheadSuggestionKeepinput||(m.elements.input.value="");var k=d(a).data("granite-omnisearch-typeahead-suggestion-queryparameters");A(a,k)}}function A(a,k,w){var n=m.elements.tagList;d(m.elements.form).trigger({type:"granite-omnisearch-predicate-update",detail:{item:a,tagList:n,queryParameters:k,tagsPredicateData:w||{}}})}function M(){var a={},k=m.elements.tagList.querySelectorAll("coral-tag");
Array.prototype.forEach.call(k,function(w){(w=d(w).data("graniteOmnisearchTagPredicateData"))&&(a[w.name]=w)});return a}function I(a){var k=a.formData,w=a.tagsPredicateData;m.restored=!0;a=function(n){var u=m.elements.form,B=u.action;if(n){var G=parseInt(History.getState().data.omnisearch.collection.limit,10)||100;u.action=B.substr(0,B.lastIndexOf("."))+".0."+Math.ceil(n/G)*G+B.substr(B.lastIndexOf("."),B.length)}return function(){u.action=B}}(q(a));k=k.reduce(function(n,u){n[u.name]=u.value;return n},
{});A(void 0,k,w);E();a()}function E(){var a=m.elements.form;S();d(a).submit()}function S(){var a=m.elements.typeaheadOverlay;clearTimeout(ea);v();a.hide()}function z(){var a=m.elements.typeahead,k=m.elements.form,w=m.elements.input.value;if(a)if(v(),w.length<m.omnisearchMinLength)S();else if(b.expand(a.dataset.graniteOmnisearchTypeaheadSrc,{query:d(k).serialize()}))return d(window).adaptTo("granite-shell-omnisearch-suggestions").getWrappedSuggestions(g(),w).then(function(n){var u=m.elements.selectList,
B=m.elements.typeaheadOverlay;if(m.open&&!m.closed){u.items.clear();n.forEach(function(R){u.items.add(R)});u.style.height="";var G=window.getComputedStyle(u);n=parseInt(G.height,10);G=parseInt(G.maxHeight,10);n<G&&(u.style.height=n+"px");0<u.items.length&&(n=u.items.getAll()[0],t(n),B.open=!0)}})}function D(a){var k=m.elements.overlay,w=k.querySelector("#granite-omnisearch-result-rail");if(a&&m.open){var n=k.dataset.graniteOmnisearchOverlayPredicatesrc;if(!n)return Promise.reject();a=b.expand(n,{location:a});
return d.ajax({url:a,cache:!1}).then(function(u){return d(window).adaptTo("foundation-util-htmlparser").parse(u).then(function(B){B=B.querySelector("#granite-omnisearch-result-rail");w.replaceWith(B);d(B).trigger("foundation-contentloaded");m.showRail&&(B=k.querySelector("#granite-omnisearch-result-rail-toggle"))&&(B.items.getAll()[1].selected=!0,m.showRail=!1)})})}return Promise.resolve()}function F(){var a=m.vent,k=function(u){window.clearTimeout(ea);ea=window.setTimeout(z,300)},w=function(u){if("Escape"===
u.key){var B=m.elements.overlay,G=m.elements.typeaheadOverlay;m.open&&!m.closed&&(G&&G.open&&G._isTopOverlay()?(u.preventDefault(),S()):B._isTopOverlay()&&(B=B.querySelector("#granite-omnisearch-result"),0===d(B).adaptTo("foundation-selections").count()&&(u.preventDefault(),ia())))}},n=function(u){function B(Q){0===y(U)&&""===window.getSelection().toString()&&((Q=da.items.last())&&Q.remove(),z());U.value.match('^"(.+)"$')&&(U.value="")}function G(Q){J.open&&(Q=W.querySelector("coral-selectlist-item.is-highlighted"))&&
Q.dataset.graniteOmnisearchTypeaheadSuggestionPredicateid&&(x(Q),z())}function R(Q){if(J.open&&(Q=W.querySelector("coral-selectlist-item.is-highlighted"))){Q.click();return}E()}function N(Q){if(J.open){Q=W.querySelector("coral-selectlist-item.is-highlighted");var Y=W.items.getAll(),ba=Y.indexOf(Q);Q&&Q.classList.remove("is-highlighted");0!==Y.length&&(Q=0<ba?Y[ba-1]:Y[Y.length-1],Q.classList.add("is-highlighted"),U.setAttribute("aria-activedescendant",Q.getAttribute("id")),r(Q,J))}}function T(Q){if(J.open){Q=
W.querySelector("coral-selectlist-item.is-highlighted");var Y=W.items.getAll(),ba=Y.indexOf(Q);Q&&Q.classList.remove("is-highlighted");0!==Y.length&&(Q=ba<Y.length-1?Y[ba+1]:Y[0],Q.classList.add("is-highlighted"),U.setAttribute("aria-activedescendant",Q.getAttribute("id")),r(Q,J))}else z()}var V=!0,U=m.elements.input,W=m.elements.selectList,J=m.elements.typeaheadOverlay,da=m.elements.tagList;switch(u.keyCode){case 8:V=!1;B(u);break;case 9:V=J.open?V:!1;G(u);break;case 13:R(u);break;case 38:J.open&&
(V=!1);N(u);break;case 40:J.open&&(V=!1);T(u);break;default:V=!1}V&&u.preventDefault()};a.on("input",".granite-omnisearch-typeahead-input",k);a.on("keydown",".granite-omnisearch-typeahead-input",n);a.on("keydown",w,!0);return function(){a.off("input",".granite-omnisearch-typeahead-input",k);a.off("keydown",".granite-omnisearch-typeahead-input",n);a.off("keydown",w,!0)}}function p(){var a=m.vent,k=function(u){u.detail.item.multiline=!1;l()},w=function(u){l();u=u.detail.item;var B=m.elements.tagList;
d(m.elements.form).trigger({type:"granite-omnisearch-predicate-clear",detail:{item:u,tagList:B}})},n=function(u){z()};a.on("coral-collection:add",".granite-omnisearch-typeahead-tags",k);a.on("coral-collection:remove",".granite-omnisearch-typeahead-tags",w);a.on("change",".granite-omnisearch-typeahead-tags",n);return function(){a.off("coral-collection:add",".granite-omnisearch-typeahead-tags",k);a.off("coral-collection:remove",".granite-omnisearch-typeahead-tags",w);a.off("change",".granite-omnisearch-typeahead-tags",
n)}}function C(){var a=m.vent,k=function(u){u=u.matchedTarget.selectedItem;var B=m.elements.input;u&&("undefined"!==typeof u.dataset.graniteOmnisearchTypeaheadNavigation?window.location=u.dataset.graniteOmnisearchTypeaheadNavigationHref:(u.dataset.graniteOmnisearchTypeaheadSuggestionPredicateid?x(u):B.value=u.value||u.content.textContent,E()))},w=function(u){m.elements.input.setAttribute("aria-activedescendant",u.target.getAttribute("id"))},n=function(u){u=u.target;var B=m.elements.input,G=m.elements.typeaheadOverlay;
B&&B.contains(u)||null===G||!G.open||G.contains(u)||S()};a.on("coral-selectlist:change",".granite-omnisearch-typeahead-overlay coral-selectlist",k);d(f).on("mouseenter",".granite-omnisearch-typeahead-overlay coral-selectlist coral-selectlist-item",w);f.addEventListener("click",n);return function(){a.off("coral-selectlist:change",".granite-omnisearch-typeahead-overlay coral-selectlist",k);d(f).on("mouseenter",".granite-omnisearch-typeahead-overlay coral-selectlist coral-selectlist-item",w);f.removeEventListener("click",
n)}}function K(){var a=m.vent,k=function(){var w=event.matchedTarget,n=m.elements.tagList,u=m.elements.tagListHolderLabel,B=m.elements.tagListHolderList;if(1===B.items.length){var G=m.elements.tagListHolder;m.elements.tagListHolderPopover.open=!1;G.hidden=!0;u.textContent=""}else u.textContent=Number(u.textContent)-1;B.items.remove(w);n.items.remove(d(w).data("graniteOmnisearchTagsHolderItemTag").tag)};a.on("click",".granite-omnisearch-typeahead-tags-holder-list [coral-list-item]",k);return function(){a.off("click",
".granite-omnisearch-typeahead-tags-holder-list [coral-list-item]",k)}}function O(){var a=m.elements.form,k=function(w){w=w.target;var n=History.getState();n.data.omnisearch=n.data.omnisearch||{};n.data.omnisearch.formData=d(w).serializeArray();n.data.omnisearch.tagsPredicateData=M();History.replaceState(n.data,n.title)};d(a).on("submit",k);return function(){d(a).off("submit",k)}}function X(){e.commons.addResizeListener(m.elements.tagList,l);window.addEventListener("resize",l);return function(){window.removeEventListener("resize",
l)}}function L(){var a=m.collectionEl,k=function(w){var n=w.target;w=History.getState();var u=n.closest(".foundation-collection-item:not(.is-lazyLoaded)");n=d(a).adaptTo("foundation-collection").getPagination();u&&n&&(u=u.dataset.datasourceIndex,w.data.omnisearch=w.data.omnisearch||{},w.data.omnisearch.collection={index:u,limit:n.limit},History.replaceState(w.data,w.title))};a.addEventListener("click",k,!0);return function(){a.removeEventListener("click",k,!0)}}function P(){var a=m.collectionEl;h.UI.Foundation.Utils.everyReverse(m.stack.collection,
function(k){k&&k();return!0});m.stack.collection=[];a&&h.UI.Foundation.Layouts.cleanAll(this);window.setTimeout(function(k){k&&d(k).adaptTo("foundation-collection").clear()},1E3,a)}function aa(a){!0===a?(d("coral-shell").addClass("non-visible"),d(".granite-skipNavigationLinks").addClass("non-visible")):(d("coral-shell").removeClass("non-visible"),d(".granite-skipNavigationLinks").removeClass("non-visible"))}function Z(a){var k=m.metadata;if(m.open)return l(),c(),Promise.resolve();if(!k||!k.dataset.graniteOmnisearchSrc)return Promise.reject();
m.open=!0;k=k.dataset.graniteOmnisearchSrc;H(!0);aa(!0);if(a&&a.location){var w=a.location.value;var n=a.location.label}else{var u=f.head.querySelector(".granite-omnisearch-location");u&&(w=u.dataset.graniteOmnisearchLocationValue,n=u.dataset.graniteOmnisearchLocationLabel)}k=b.expand(k,{location:w});return d.get(k).then(function(B){return d(window).adaptTo("foundation-util-htmlparser").parse(B)}).then(function(B){if(B=B.querySelector(".granite-omnisearch-overlay"))return d(B).css("zIndex",f.querySelector("coral-shell-header").style.zIndex+
10),m.init(B),m.stack.open.push(F()),m.stack.open.push(p()),m.stack.open.push(C()),m.stack.open.push(K()),m.stack.open.push(O()),m.stack.open.push(X()),m.closable||(m.elements.close.hidden=!0),f.body.appendChild(B),d(B).trigger("foundation-contentloaded"),l(),c(),w&&n&&d(f).trigger({type:"granite-shell-omnisearch-predicate-location:update",detail:{location:w,locationSuggestion:n}}),fa}).then(function(){if(a)a.formData&&I(a);else{window.location.pathname.startsWith(m.searchURL)||window.sessionStorage.setItem("granite.shell.omnisearch.pathWhenOpeningOmnisearch",
window.location.pathname);var B=w?h.I18n.get("Location: {0} | AEM Search",w):h.I18n.get("AEM Search");History.pushState({omnisearch:{referrer:!0,location:{value:w,label:n}}},B,m.searchURL)}})}function ca(){m.destroy();var a=f.getElementById("shell-collectionpage-rail-toggle");a&&(a.items.getAll()[0].selected=!0);var k=f.getElementById("granite-omnisearch-trigger");ha&&k&&(ha=!1,window.setTimeout(function(){var w=k.querySelector("button");k.open=!1;w.focus();w.classList.add("focus-ring")},100));H(!1);
aa(!1);fa=Promise.resolve()}function ia(){if(m.closable&&!m.closed)if(m.closed=!0,v(),m.restored){var a=window.sessionStorage.getItem("granite.shell.omnisearch.pathWhenOpeningOmnisearch");History.pushState({},null,a)}else History.back()}function ja(){var a=m.elements.form.querySelector("#granite-omnisearch-is-opened-filter");null!==a&&a.remove()}var ea,ha=!1,fa=Promise.resolve(),m=new function(){function a(){Object.keys(W).forEach(function(J){h.UI.Foundation.Utils.everyReverse(W[J],function(da){da&&
da();return!0})})}function k(){n={};u=B=G=T=!1;R=!0;N=null;W={open:[],collection:[]};V=null}function w(){Object.keys(n).forEach(function(J){(J=n[J])&&J.remove()})}var n,u,B,G,R,N,T,V,U,W;k();return{get open(){return u||!1},set open(J){u=!!J},get elements(){return n||{}},get metadata(){return f.querySelector(".granite-omnisearch-src")},get vent(){return N},get closable(){return R},set closable(J){R=!!J},get showRail(){return G},set showRail(J){G=!!J},get stack(){return W},get searchURL(){return this.metadata?
this.metadata.dataset.graniteOmnisearchSearchUrl:null},get restored(){return B},set restored(J){B=!!J},get closed(){return T},set closed(J){T=!!J},get collectionEl(){return V},get omnisearchMinLength(){return U},set collectionEl(J){V=J},init:function(J){a();n.overlay=J;n.form=J.querySelector(".granite-omnisearch-form");n.typeahead=n.form.querySelector(".granite-omnisearch-typeahead");n.input=n.typeahead.querySelector(".granite-omnisearch-typeahead-input");n.tagList=n.typeahead.querySelector(".granite-omnisearch-typeahead-tags");
n.tagListHolder=n.typeahead.querySelector(".granite-omnisearch-typeahead-tags-holder");n.tagListHolderLabel=n.typeahead.querySelector(".granite-omnisearch-typeahead-tags-holder-label");n.tagListHolderPopover=J.querySelector(".granite-omnisearch-typeahead-tags-holder-popover");n.tagListHolderList=n.tagListHolderPopover.querySelector(".granite-omnisearch-typeahead-tags-holder-list");n.selectList=n.typeahead.querySelector(".granite-omnisearch-typeahead-suggestions");n.typeaheadOverlay=n.typeahead.querySelector(".granite-omnisearch-typeahead-overlay");
n.close=n.typeahead.querySelector(".granite-omnisearch-typeahead-close");U=J.getAttribute("omnisearchMinLength");N=new Vent(J)},destroy:function(){a();N&&N.destroy();P();w();k()}}};d(window).adaptTo("foundation-registry").register("foundation.form.response.ui.success",{name:"granite.omnisearch.result",handler:function(a,k,w,n,u,B){d(window).adaptTo("foundation-util-htmlparser").parse(B).then(function(G){var R=m.elements.overlay.querySelector(".granite-omnisearch-content");ja();var N=R.querySelector("#granite-omnisearch-result-actionbar"),
T=G.querySelector("#granite-omnisearch-result-actionbar");N?N.querySelector("#granite-omnisearch-result-rail-toggle")?N.querySelector("betty-titlebar-secondary").replaceWith(T.querySelector("betty-titlebar-secondary")):T?N.replaceWith(T):N.remove():T&&R.querySelector("#granite-omnisearch-result-header").appendChild(T);N=R.querySelector("#granite-shell-search-result-selectionbar");T=G.querySelector("#granite-shell-search-result-selectionbar");N&&T?N.replaceWith(T):N?N.remove():T&&R.appendChild(T);
var V=G.querySelector("#granite-omnisearch-facet");N=d(window).adaptTo("granite-omnisearch-internal-facets");V?(T=JSON.parse(V.dataset.graniteOmnisearchFacetConfig),V=JSON.parse(V.dataset.graniteOmnisearchFacetFacets),N.updateCount(V,T)):N.updateCount(null);N=R.querySelector("#granite-omnisearch-result-content");G=G.querySelector("#granite-omnisearch-result-content");P();N.replaceWith(G);var U=G.querySelector(".granite-omnisearch-result.foundation-collection");N=d(U);m.collectionEl=U;var W=q();if(W){T=
JSON.parse(U.dataset.foundationLayout);if(V=History.getState().data.omnisearch.collection.limit)T.limit=V;U.dataset.foundationLayout=JSON.stringify(T);N.removeData("foundation-layout");N.data("foundation-layout",T)}U&&m.stack.collection.push(L());U&&"true"===G.dataset.supportSorting&&(G=JSON.parse(U.dataset.foundationLayout),G.sortMode="remote",U.dataset.foundationLayout=JSON.stringify(G),N.removeData("foundation-layout"),N.data("foundation-layout",G));R.hidden=!1;d(R).trigger("foundation-contentloaded");
G=f.querySelectorAll(".foundation-collection");Array.prototype.forEach.call(G,function(J){(J=d(J).adaptTo("foundation-selections"))&&J.clear()});W&&(window.requestAnimationFrame(function(){var J=U.querySelector("[data-datasource-index\x3d'"+W+"']");J&&d(U.scrollContainer).animate({scrollTop:J.getClientRects()[0].top-U.scrollContainer.getClientRects()[0].top},0)}),G=History.getState(),delete G.data.omnisearch.collection,History.replaceState(G.data,G.title));(R=R.querySelector("#granite-omnisearch-result-rail-toggle"))&&
m.showRail&&(R=R.items.getAll()[1],R.dataset.graniteToggleableControlTarget&&(R.selected=!0,m.showRail=!1))})}});d(function(){if(m.metadata&&window.location.pathname.startsWith(m.searchURL)){var a=History.getState().data.omnisearch;m.closable=a&&a.referrer;Z(a||{})}});d(window).on("statechange",function(){var a=History.getState().data.omnisearch;if(a)m.open||Z(a);else if(m.open||m.closed)(a=f.head.querySelector("meta[name\x3d'granite.omnisearch.searchpage']"))&&"true"===a.content?window.location.reload():
ca()});d(f).on("coral-overlay:beforeopen",".granite-omnisearch-multiresult-row coral-quickactions",function(a){a.preventDefault()});d(f).on("click",".granite-omnisearch-viewall-button",function(a){a.preventDefault();a=a.currentTarget;var k=a.dataset.graniteOmnisearchTypeaheadSuggestionPredicateid,w=JSON.parse(a.dataset.graniteOmnisearchTypeaheadSuggestionQueryparameters);k&&(A(a,w),E())});d(f).on("foundation-mode-change",function(a,k,w){if(a=f.querySelector(".granite-omnisearch-typeahead"))a.style.visibility=
"selection"===k?"hidden":""});d(f).on("coral-cyclebutton:change",".granite-collection-switcher[data-granite-collection-switcher-target\x3d'#granite-omnisearch-result']",function(a){P();var k=function(n){n=n.target;var u=d(n),B=JSON.parse(n.dataset.foundationLayout),G=n.closest("#granite-omnisearch-result-content");m.collectionEl.nodeName!==n.nodeName&&(m.collectionEl=n,m.stack.collection.push(L()),G&&"true"===G.dataset.supportSorting&&"remote"!==B.sortMode&&(B.sortMode="remote",n.dataset.foundationLayout=
JSON.stringify(B),u.removeData("foundation-layout"),u.data("foundation-layout",B)),d(f).off("foundation-contentloaded","#granite-omnisearch-result",k),window.clearTimeout(w))};var w=window.setTimeout(function(){d(f).off("foundation-contentloaded","#granite-omnisearch-result",k)},5E3);d(f).on("foundation-contentloaded","#granite-omnisearch-result",k)});d(f).on("foundation-layout-perform","#granite-omnisearch-result",function(a){a=JSON.parse(a.target.dataset.foundationLayout);d.cookie("shell.omnisearch.results.layoutId",
a.layoutId,{path:"/"})});d(f).on("granite-shell-omnisearch-predicate-location:updated",function(a){a.stopImmediatePropagation();fa=D(a.detail.location)});d(f).on("granite-shell-omnisearch-predicate-location:cleared",function(a){a.stopImmediatePropagation();a=m.elements.overlay;var k=a.querySelector("#granite-omnisearch-result-rail");k=d(k);var w=k.adaptTo("foundation-toggleable");(a=a.querySelector("#granite-omnisearch-result-rail-toggle"))&&a.remove();w.hide();k.empty();m.elements.tagList.items.clear()});
d(f).on("granite-omnisearch-predicate-clear",function(a){var k=a.detail.tagList;a.detail.reset&&k.items.getAll().forEach(function(w){w.matches("#granite-omnisearch-field-locationtag")||w.remove()})});d(function(){if(d(window).adaptTo("foundation-preference").getBoolean("shortcutsEnabled",!0))e.keys.on("/",function(a){var k=m.elements.typeahead;k&&k.contains(f.activeElement)||m.open||d(".granite-collection-selectionbar \x3e .foundation-mode-switcher-item-active").length||(a.preventDefault(),Z())})});
d(f).on("click","#granite-omnisearch-trigger",function(a){a.preventDefault();ha=!0;Z()});d(f).on("coral-cyclebutton:change","#granite-shell-actionbar .granite-toggleable-control",function(a){if(a=a.originalEvent.detail.selection.dataset.graniteOmnisearchFilter){var k=f.querySelector(a).dataset.foundationCollectionId;m.showRail=!0;Z().then(function(){A(void 0,{_path:k});var w=m.elements.form,n=w.querySelector("#granite-omnisearch-is-opened-filter");null===n&&(n=f.createElement("input"),n.id="granite-omnisearch-is-opened-filter",
n.type="hidden",n.name="opened-through-filter",n.value=!0,w.appendChild(n));E()})}});d(f).on("granite-omnisearch-external-search",function(a){var k=a.detail.queryParams;Z().then(function(){A(void 0,k);E()})});d(f).on("click",".granite-omnisearch-typeahead-close",function(a){a.preventDefault();ia()})})(document,Coral,Granite,Granite.$,Granite.URITemplate);
(function(f,e){e(f).adaptTo("foundation-registry").register("foundation.adapters",{type:"foundation-collection-item-action",selector:"#granite-omnisearch-result-content .foundation-collection",adapter:function(h){return{execute:function(d){var b;if(b=d.classList.contains("foundation-collection-navigator")?d:d.querySelector(".foundation-collection-navigator")){var c=b.dataset.foundationCollectionNavigatorHref;var g=b.dataset.foundationCollectionNavigatorTarget}c||(c=e(d).find("link[rel\x3dproperties]").attr("href"));
c&&f.open(c,g||"_self")}}}})})(window,Granite.$);
(function(f,e,h,d,b,c){function g(t,v){v&&q(t);f.UNIFIED_SHELL&&UNIFIED_SHELL.ENABLED||(t.intervalId=setInterval(function(){t.badgeEl&&(e.contains(t.badgeEl)?q(t,!0).fail(function(x,A){x&&404===x.status&&clearInterval(t.intervalId)}):(t.badgeMenu&&t.badgeMenu.remove(),l.delete(t.badgeEl),clearInterval(t.intervalId)))},2E3))}function q(t,v){var x=t.badgeEl;return r(t,v).then(function(A){A=A.total;var M=x.dataset.graniteShellBadgeLabelTemplate;x.setAttribute("badge",A);M&&x.setAttribute("aria-label",
M.replace("{{count}}",A))})}function r(t,v){var x=t.badgeEl,A=t.user,M=t.src,I=H.get(x),E=f.sessionStorage.getItem("granite.shell.badge.user"),S=parseInt(f.sessionStorage.getItem("granite.shell.badge.timestamp"),10);if(!(E!==A||isNaN(S)||S+6E4<=Date.now())||E===A&&I&&"pending"===I.state()){if(v)return h.Deferred().reject().promise();if(I=f.sessionStorage.getItem("granite.shell.badge.data"))return h.Deferred().resolve(JSON.parse(I)).promise()}I=h.ajax({url:M,cache:!1,timeout:6E4});H.set(x,I);return I.then(function(z){try{if(v){var D=
JSON.parse(f.sessionStorage.getItem("granite.shell.badge.data"));b.AsyncUtil.displayPopupNotifications(z,D)}t.dirty=!0;f.sessionStorage.setItem("granite.shell.badge.user",A);f.sessionStorage.setItem("granite.shell.badge.timestamp",Date.now());f.sessionStorage.setItem("granite.shell.badge.data",JSON.stringify(z))}catch(F){console.warn("Notification data could not be stored.",F)}return z})}function y(t){var v=new c.Shell.Menu,x=t.data;t=t.total;v.placement=c.Overlay.placement.RIGHT;v.classList.add("foundation-toggleable",
"foundation-layout-util-maxheight80vh","foundation-layout-util-width300","foundation-layout-util-breakword");v.setAttribute("aria-live","off");v.setAttribute("aria-labelledby","granite-shell-badge-trigger");x&&x.forEach(function(A){var M=c.commons.getUID(),I=h(e.createElement("div")).addClass("granite-shell-badge-item"),E=h(e.createElement("a")).addClass("granite-shell-badge-item-link").attr("href",A.detailsUrl);I.context.style.backgroundImage="url("+A.backgroundImageUrl+")";I.context.style.backgroundSize=
"36px 36px";I.context.style.backgroundRepeat="no-repeat";I.context.style.backgroundPosition="0px 4px";A.title&&(h(e.createElement("span")).attr("id","title_"+M).addClass("granite-shell-badge-item-title").html(A.title).appendTo(I),E.attr("aria-labelledby","title_"+M));if(A.description){var S=h(e.createElement("span")).attr("id","description_"+M).addClass("granite-shell-badge-item-description"),z=S.text;A=A.description;A=(new DOMParser).parseFromString(A,"text/html").documentElement.textContent;z.call(S,
A).appendTo(I);E.attr("aria-describedby","description_"+M)}E.appendTo(I);I.appendTo(v)});h(e.createElement("div")).addClass("granite-shell-badge-item-inbox").appendTo(v).append(h(e.createElement("a")).text(b.I18n.get("View All ({0} New)",t,"link to notification inbox")).addClass("granite-shell-badge-console granite-shell-badge-item-link")).attr("aria-label",b.I18n.get("View All ({0} New)",t,"link to notification inbox"));return v}var l=new WeakMap,H=new WeakMap;h(e).on("click",".granite-shell-badge",
function(t){t.preventDefault();var v=l.get(this),x=v.badgeEl;t=v.user;if(v.src&&t){var A=d.expand(x.dataset.graniteShellBadgeConsole,{ref:f.location.href});r(v).then(function(M){var I=v.badgeMenu;if("0"===M.total)f.location=A;else if(I){var E=h(I);I=E.adaptTo("foundation-toggleable");I.isOpen()?I.hide():(I=v.dirty?v.badgeMenu=y(M):v.badgeMenu,E=h(I),v.dirty=!1,E.find(".granite-shell-badge-console").attr("href",A),E.appendTo(e.body),requestAnimationFrame(function(){E.adaptTo("foundation-toggleable").show(x)}))}else I=
y(M),E=h(I),E.find(".granite-shell-badge-console").attr("href",A),E.appendTo(e.body),E.on("foundation-toggleable-hide",function(){E.detach()}),v.dirty=!1,requestAnimationFrame(function(){E.adaptTo("foundation-toggleable").show(x)}),v.badgeMenu=I},function(){f.location=A})}});h(e).on("foundation-contentloaded",function(t){t.target.querySelectorAll(".granite-shell-badge").forEach(function(v){var x=v.dataset.graniteShellBadgeSrc;x&&!l.has(v)&&(x={badgeEl:v,src:x,user:v.dataset.graniteShellBadgeUser},
x={badgeEl:x.badgeEl||void 0,badgeMenu:x.badgeMenu||void 0,dirty:x.dirty||!1,intervalId:x.intervalId||void 0,user:x.user||void 0,src:x.src||void 0},l.set(v,x),g(x,!0))})})})(window,document,Granite.$,Granite.URITemplate,Granite,Coral);
(function(f,e,h,d){h(f).adaptTo("foundation-registry").register("foundation.adapters",{type:"foundation-toggleable",selector:"coral-shell-menu.foundation-toggleable",adapter:function(c){var g=h(c);g.data("foundation-toggleable.internal.preventTargetClickHandling",!0);g.on("coral-overlay:open",function(q){if(q.target===c){if(q=d.Overlay._getTarget(c))q.open=!0;g.trigger("foundation-toggleable-show")}});g.on("coral-overlay:close",function(q){if(q.target===c){if(q=d.Overlay._getTarget(c))q.open=!1;g.trigger("foundation-toggleable-hide")}});
return{isOpen:function(){return c.open},show:function(q){q instanceof Element&&(c.target=q,c.show())},hide:function(){c.hide()}}}});var b=d.Shell.Menu.prototype._handleGlobalClick;d.Shell.Menu.prototype._handleGlobalClick=function(c){if(h(this).data("foundation-toggleable.internal.preventTargetClickHandling")){var g=this.target;if(g&&(g===c.target||g.contains(c.target)))return}return b.apply(this,arguments)}})(window,document,Granite.$,window.Coral);
(function(f,e,h){function d(q){var r=q.filter("#granite-shell-search-result-actionbar-center"),y=q.filter("#granite-shell-search-result-actionbar-right"),l=h("#granite-shell-actionbar"),H=l.children("betty-titlebar-title"),t=l.children("betty-titlebar-secondary");r.length&&(H.prop("hidden",!0).after(r),t.prop("hidden",!0).after(y));l.trigger("foundation-contentloaded");return{clean:function(){H.prop("hidden",!1);r.remove();t.prop("hidden",!1);y.remove()},replace:function(v){r=v.filter("#granite-shell-search-result-actionbar-center").replaceAll(r);
y=v.filter("#granite-shell-search-result-actionbar-right").replaceAll(y);l.trigger("foundation-contentloaded")}}}function b(q){var r=q.filter("#granite-shell-search-result-selectionbar");r.appendTo(e.body).trigger("foundation-contentloaded");return{clean:function(){r.remove()},replace:function(y){r=y.filter("#granite-shell-search-result-selectionbar").replaceAll(r).trigger("foundation-contentloaded")}}}function c(q){var r=q.filter("#granite-shell-search-result-content"),y=h("#granite-shell-content .foundation-layout-panel-content").prop("hidden",
!0);r.insertAfter(y).trigger("foundation-contentloaded");return{clean:function(){r.remove();y.prop("hidden",!1)},replace:function(l){r=l.filter("#granite-shell-search-result-content").replaceAll(r).trigger("foundation-contentloaded")}}}function g(){var q=h(e),r=q.data("granite-shell-search.internal.stack");r&&Granite.UI.Foundation.Utils.everyReverse(r,function(y){y.clean();return!0});q.removeData("granite-shell-search.internal.stack")}h(f).adaptTo("foundation-registry").register("foundation.form.response.ui.success",
{name:"granite.shell.search.result",handler:function(q,r,y,l,H,t){h(f).adaptTo("foundation-util-htmlparser").parse(t).then(function(v){var x=h(v).children();v=h(e);var A=v.data("granite-shell-search.internal.stack");A?A.forEach(function(M){M.replace(x)}):(A=[],A.push(d(x)),A.push(b(x)),A.push(c(x)),v.data("granite-shell-search.internal.stack",A))})}});h(e).on("click",".granite-shell-search-result-close",function(q){q.preventDefault();g()});h(e).on("foundation-toggleable-hide",".foundation-layout-panel-rail-panel",
function(q){0!==h(this).has(".granite-shell-search-form").length&&g()})})(window,document,Granite.$);
(function(f,e,h){function d(p,C,K){[].forEach.call(p.children,function(O){C!==O&&1===O.nodeType&&-1===I.indexOf(O.tagName.toLowerCase())&&K(O)})}function b(p,C){C&&(p?(void 0===C.dataset.cachedAriaHidden&&(C.dataset.cachedAriaHidden=C.getAttribute("aria-hidden")||""),C.setAttribute("aria-hidden","true")):(p=C.dataset.cachedAriaHidden,delete C.dataset.cachedAriaHidden,""===p||void 0===p?C.removeAttribute("aria-hidden"):C.setAttribute("aria-hidden",p)))}function c(p,C){d(p,C,function(K){b(!0,K)})}function g(p,
C){d(p,C,function(K){b(!1,K)})}function q(p){for(var C=p.parentNode;p!==f.body&&C;)c(C,p),p=C,C=p.parentNode}var r,y,l,H,t,v,x,A=!!e.CoachMark,M,I=["template","script","style","meta","link"],E=function(){var p=y.panelStacks.getAll(),C=y.stepLists.getAll();p=p[0].selectedItem;var K=f.querySelector(p.dataset.graniteShellOnboardingStepTarget),O=C[0].selectedItem;if(t){var X=p.querySelector(".granite-shell-onboarding-panel-title");X?t.setAttribute("aria-labelledby",X.id):t.removeAttribute("aria-labelledby");
var L=p.querySelector(".granite-shell-onboarding-panel-desc");L?t.setAttribute("aria-describedby",L.id):t.removeAttribute("aria-describedby");C[0].items.getAll().forEach(function(P){var aa=P.querySelector('[handle\x3d"link"]'),Z=P.querySelector('[handle\x3d"accessibilityLabel"]'),ca=P.querySelector('[handle\x3d"stepMarkerContainer"]');if(P.hasAttribute("labelled")||P.hasAttribute("labelledby"))Z.id=Z.id||P.id+"-accessibilityLabel",ca.id=ca.id||P.id+"-stepMarkerContainer",aa.setAttribute("aria-labelledby",
[Z.id,ca.id].join(" ")),P.removeAttribute("aria-label"),P.removeAttribute("aria-labelledby");aa.removeAttribute("aria-describedby");aa.setAttribute("aria-live","off");aa.setAttribute("aria-atomic","true");aa.setAttribute("aria-relevant","additions");P.hasAttribute("title")&&(aa.setAttribute("title",P.getAttribute("title")),P.removeAttribute("title"));P.hasAttribute("describedby")&&P.removeAttribute("aria-describedby")});O&&(x&&window.clearTimeout(x),e.commons.nextFrame(function(){var P=O.querySelector('[handle\x3d"link"]');
P!==f.activeElement&&t!==f.activeElement?(P.setAttribute("aria-live","off"),L&&P.setAttribute("aria-describedby",L.id),P.focus()):x=window.setTimeout(function(){P.setAttribute("aria-live","assertive");L&&P.setAttribute("aria-describedby",L.id)},20)}))}K?(A?(l.hidden=!1,l.target=K):(C=h(K).outerWidth()-2,H.width(C).removeClass("is-hidden"),setTimeout(function(){H.position({my:"left top",at:"left top",of:K,collision:"none"})},100)),v.position({my:"left top",at:"right+15 top",of:K,collision:"flipfit"})):
(A?l.hidden=!0:H.addClass("is-hidden"),v.position({my:"center",at:"center",of:window,collision:"none"}))},S=function(p){var C=r.dataset.graniteShellOnboardingPrefname;h(window).adaptTo("foundation-preference").set(C,p)},z=function(p){(p||r.querySelector(".granite-shell-onboarding-checkbox").hasAttribute("checked"))&&S(!1);if(r){r.removeAttribute("open");r.off("coral-wizardview:change",E);p=r;for(var C=p.parentNode;p!==f.body&&C;)g(C,p),p=C,C=p.parentNode}l&&H.remove();t&&(t.removeAttribute("aria-describedby"),
t.removeAttribute("aria-labelledby"));M&&M.focus();h(window).off("resize",E);r=l=y=H=t=v=M=null},D=function(p){p.target===r&&z()},F=function(){var p=f.querySelector(".granite-shell-onboarding-src");p&&(p=p.dataset.graniteShellOnboardingSrc)&&Granite.UI.Foundation.XSS.isSameOrigin(p)&&h.ajax({url:p,cache:!1}).then(function(C){var K=h(window).adaptTo("foundation-util-htmlparser");C=Granite.UI.Foundation.XSS.sanitizeHtml(C);K.parse(C).then(function(O){O=h(O).children();h("body").append(O).trigger("foundation-contentloaded");
r=O[0];r.setAttribute("trapFocus","on");r.setAttribute("open","");r.querySelector(".granite-shell-onboarding-panelstack \x3e coral-panel:first-child").setAttribute("selected","");y=r.querySelector("coral-wizardview");O=r.querySelector(".granite-shell-onboarding-checkbox");h(O).on("change",function(){S(!this.checked)});t=r.querySelector(".granite-shell-onboarding-popover");v=h(t);A?(l=f.createElement("coral-coachmark"),l.setAttribute("variant","light")):(l=f.createElement("div"),l.className="granite-shell-onboarding-highlight");
H=h(l);f.body.appendChild(l);q(r);e.commons.ready(r,function(){h(window).on("resize",E);var X=A?h(r).css("zIndex")+1:h(r).css("zIndex")-1;H.css("zIndex",X);r.on("coral-wizardview:change",E);r.on("click",".granite-shell-onboarding-done",function(){z(!0)});r.on("click","[coral-close]",function(L){z()});r.on("click",D);r.on("coral-overlay:close",D);E();e.commons.nextFrame(function(){t&&t.focus()})})})})};h(function(){h(window).adaptTo("foundation-preference").getBoolean("granite.shell.showonboarding620",
!0)&&F()});h(f).on("click",".granite-shell-onboarding-trigger",function(p){p.preventDefault();F();(p=p.target.closest(".foundation-toggleable"))&&(M=p.elementToFocusWhenHidden||p.returnFocusToElement)})})(document,Coral,Granite.$);
(function(f,e){e(f).on("foundation-mode-change",function(d,b,c){(d=f.querySelector(".granite-shell-header"))&&d.dataset.graniteShellHeaderModeGroup===c&&(d.style.visibility="selection"===b?"hidden":"")});var h=e("#granite-collection-switcher-toggle-button");e(f).ready(function(){"true"===localStorage.getItem("focus-to-view-settings")&&(h.focus(),localStorage.removeItem("focus-to-view-settings"))})})(document,Granite.$);
(function(f,e,h){var d=function(c){var g=f.createElement("div");g.innerHTML=c;return g.textContent};e(f).on("coral-shell-help:search",".granite-shell-help",function(c){var g=this,q=e(this),r=c.originalEvent.detail.value;(c=q.data("granite-shell-help.internal.lastXhr"))&&4!==c.readyState&&c.abort();c=h.expand(g.dataset.graniteShellHelpEndpoint,{q:r});c=e.ajax(c,{dataType:"jsonp",timeout:1E4});q.data("granite-shell-help.internal.lastXhr",c);c.then(function(y){var l=y.results.map(function(t){return{tags:d(t.t0).split(/,\s*/),
title:d(t.title),href:t.href,target:"_blank"}});y=parseInt(y.resultcount.total,10);var H=h.expand(g.dataset.graniteShellHelpSite,{q:r});g.showResults(l,y,H)},function(y,l){g.showError()})});var b=new WeakMap;e(f).on("change",".granite-shortcuts-dialog-enable-switch",function(c){var g=this;c=e(g).closest(".granite-shortcuts-dialog");e(window).adaptTo("foundation-preference").set("shortcutsEnabled",g.checked);c.find(".granite-shortcuts-dialog-enable-alert").prop("hidden",g.checked);b.has(g)||(b.set(g,
!g.checked),c.on("coral-overlay:close",function(){b.get(g)!==g.hasAttribute("checked")&&window.location.reload()}))})})(document,Granite.$,Granite.URITemplate);
(function(f,e){function h(b,c,g){b={element:c.detail&&c.detail._id||"No element defined",type:"tree-item",action:g,widget:{name:"content tree",type:"tree"},feature:"aem:collectionpage",attributes:{}};e(window).adaptTo("foundation-tracker").trackEvent(b)}function d(b,c){var g=b.getAttribute("root-id");if(c.startsWith(g)){c=c.replace(g,"").split("/").filter(function(y){return y});var q=[],r=g;c.forEach(function(y){y=r+"/"+y;q.push({id:y});r=y});0===q.length&&q.push({id:g});b.setAttribute("children",
JSON.stringify(q))}}e(f).on("foundation-toggleable-show",".shell-collectionpage-rail-panel[data-shell-collectionpage-rail-panel\x3d'content-tree']",function(b){b=this.querySelector(".shell-collectionpage-tree");b.classList.contains("is-lazyLoaded")&&(b.classList.remove("is-lazyLoaded"),b.init&&b.init())});e(function(){var b=e(".shell-collectionpage-tree").first(),c=b[0];c&&(e(f).on("change","betty-breadcrumbs.granite-collection-navigator",function(g){if(g=this.selectedItem.dataset.graniteCollectionNavigatorCollectionid){var q=
c.findItemById(g);q?q.selected=!0:c.classList.contains("is-lazyLoaded")&&d(c,g)}}),e(f).on("foundation-collection-reload",".foundation-collection",function(g){var q=c.dataset.shellCollectionpageTreeTarget;e(g.target).is(q)&&(c.classList.contains("is-lazyLoaded")?d(c,g.target.dataset.foundationCollectionId):c.reload(g.target.dataset.foundationCollectionId))}),e(f).on("foundation-selections-change",".foundation-collection",function(g){var q=c.dataset.shellCollectionpageTreeTarget;if(e(g.target).is(q))if(g=
g.target.dataset.foundationCollectionId,c.classList.contains("is-lazyLoaded"))d(c,g);else if(g=c.findItemById(g))b.one("expand",function(r){c._scrollToElement(r.detail)}),g.selectable&&(g.selected=!0)}),b.on("change",function(g){g=g.detail.selectedItem;var q=e(c.dataset.shellCollectionpageTreeTarget),r=q.adaptTo("foundation-collection");r&&g&&g.id!==q[0].dataset.foundationCollectionId&&r.load(g.id)}),b.on("expand",function(g){e(this).is(":visible")&&h(this,g,"expand")}),b.on("collapse",function(g){e(this).is(":visible")&&
h(this,g,"collapse")}))})})(document,Granite.$);
(function(f,e){function h(b){var c=e("#granite-collection-switcher-toggle.granite-collection-switcher");b?d.has(c[0])&&c.append(d.get(c[0])):(b=c.find(".granite-collection-switcher-settings"),b.length&&(b.detach(),d.set(c[0],b[0])))}var d=new WeakMap;e(function(){var b=e(".shell-collectionpage-view").first(),c=b.data("shellCollectionpageViewCookie"),g=b.attr("data-shell-collectionpage-view-target");if(c&&g){var q=b.data("shellCollectionpageViewSettings")||[],r=b.attr("data-shell-collectionpage-view-layoutId");
r=0<=q.indexOf(r);h(r);e(f).on("foundation-layout-perform",function(y){y=e(y.target);if(y.is(g)){y=y.data("foundationLayout");b.attr("data-shell-collectionpage-view-layoutId",y.layoutId);var l=0<=q.indexOf(y.layoutId);h(l);e.cookie(c.name,y.layoutId,c)}})}});e(f).on("foundation-toggleable-beforeshow",function(b){if(e(b.target).is(".shell-collectionpage-viewsettings")){var c=e(".shell-collectionpage-view").first().attr("data-shell-collectionpage-view-layoutId"),g=e("#granite-collection-switcher-toggle-button");
e(".coral_close").click(function(){g.focus()});b.target.querySelector(".shell-collectionpage-viewsettings-tablist").items.getAll().find(function(q){q.getAttribute("data-shell-collectionpage-viewsettings-name")===c&&(q.selected=!0)});e(f).on("keyup",function(q){"Escape"===q.key&&0<e("#shell-collectionpage-viewsettings-form").length&&g.focus()});e(f).click(function(q){q=e(q.target);e(!q.closest("#shell-collectionpage-viewsettings-form").length&&".shell-collectionpage-viewsettings").is(":visible")&&
g.focus()})}})})(document,Granite.$);
(function(f,e,h){e(f).adaptTo("foundation-registry").register("foundation.form.response.ui.success",{name:"granite.view-settings.result",handler:function(d,b,c,g,q){e(".shell-collectionpage-view")&&e(".shell-collectionpage-view").first()&&(d=e(".shell-collectionpage-view").first(),d.data("shellCollectionpageViewCookie")&&d.data("shellCollectionpageViewCookie").name&&(d=d.data("shellCollectionpageViewCookie").name,c=d+"-sortName",e.removeCookie(d,{path:"/"}),e.removeCookie(c,{path:"/"})));e(f).adaptTo("foundation-util-messenger").put(null,
b.message||h.I18n.get("The form has been submitted successfully"),"success");localStorage.setItem("focus-to-view-settings","true");f.location.reload()}})})(window,Granite.$,Granite);