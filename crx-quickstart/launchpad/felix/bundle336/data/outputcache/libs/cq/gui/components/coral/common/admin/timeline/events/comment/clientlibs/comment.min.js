(function(e,b){function p(a,c){if(a){var d=c.closest("form");a=encodeURIComponent(a).replace(/%2F/g,"/");b.ajax({url:a,type:d.attr("method")||"post",data:{":operation":d.data("operation"),path:a,message:c.val(),_charset_:"utf-8"},success:function(){k++;l();f();c.blur()},error:function(){g++;var m=d.data("errormessage");b(window).adaptTo("foundation-ui").notify("",m?Granite.I18n.getVar(m):Granite.I18n.get("Failed to create comment"),"error");l()}})}}function f(a){a=a||b("input[name\x3dcq-common-admin-timeline-toolbar-actions-comment]");
a.val("")}function l(){h--;0>=h&&(1<n?(0==g&&b(window).adaptTo("foundation-ui").notify("",Granite.I18n.get("Comments added to multiple items."),"success"),hideActionButton()):b(".cq-common-admin-timeline-events").trigger("cq-common-admin-timeline-change.cq-common-admin-timeline-events"))}var h=0,n,k,g;b(e).on("keydown.cq-common-admin-timeline-toolbar-actions-comment","input[name\x3dcq-common-admin-timeline-toolbar-actions-comment]",function(a){if(13==a.which&&(a.preventDefault(),!a.ctrlKey&&!a.altKey&&
!a.metaKey&&(a=b(this),""!==a.val()))){var c=[];b(".cq-common-admin-timeline").data("paths")&&(c=b(".cq-common-admin-timeline").data("paths"));h=n=c.length;for(var d=g=k=0;d<c.length;d++)p(c[d],a)}});b(e).on("click.cq-common-admin-timeline-toolbar-actions-comment",".cq-common-admin-timeline-toolbar-actions-comment-button",function(a){b("cq-common-admin-timeline-toolbar-actions-comment-actions").toggle()});b(e).on("cq-common-admin-timeline-change.cq-common-admin-timeline",".cq-common-admin-timeline",
function(a,c){f()});b(e).on("click.cq-common-admin-timeline-toolbar-actions-comment",".cq-common-admin-timeline-toolbar-actions-button",function(a){f()});b(e).on("click.cq-common-admin-timeline-toolbar-actions-comment",".cq-common-admin-timeline-alerts-workflow-ribbon",function(a){f()});b(e).on("change.cq-common-admin-timeline-toolbar-actions-comment",".cq-common-admin-timeline-filter",function(a){f()})})(document,Granite.$);