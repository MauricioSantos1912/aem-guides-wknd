(function(v,p,a){function w(q,k){if(!a(".granite-collection-switcher-settings").length){var h=k.data("foundationModeGroup"),n=k.data("columnsStateId");h="granite-omnisearch-result"===h?"#granite-omnisearch-result":"."+h;var l=a("[data-granite-collection-switcher-target\x3d'"+h+"']").get(0);k=k.data("configureColumnsDialogUriTemplate")||"/mnt/overlay/wcm/core/content/coral/common/configurecolumnsdialog.html{+id}";0<a(".cq-damadmin-admin-childpages").length&&(k="/mnt/overlay/dam/gui/content/commons/configurecolumnsdialog.html{+id}",
n="aem.assets.listview.columns");if(l){var g=u[h];q?(g||(q=p.I18n.get("View Settings"),g={markup:a('\x3ccoral-cyclebutton-action icon\x3d"gear" class\x3d"foundation-collection-action"\x3e'+q+"\x3c/coral-quickactions-item\x3e")},u[h]=g),g.markup.data("foundationCollectionAction",{target:h,action:"foundation.dialog",data:{src:k+"?stateId\x3d"+(n?n:"aem.sites.listview.columns")},relScope:"none"}),g.action=l.actions.add(g.markup.get(0)),a(g.action).off("click.view-settings").on("click.view-settings",
function(t){g.markup.data("foundationCollectionAction").data.src+="\x26_cc\x3d"+Date.now()})):g&&l.actions.remove(g.action)}}}var u={};a(v).on("foundation-layout-perform",".foundation-collection",function(q){var k=a(q.target),h=k.data("foundationLayout");a(v).one("foundation-selections-change",".foundation-collection",function(n){n="list"===h.layoutId;w(n,k);if(!(0>=a("[data-granite-collection-switcher-target\x3d'#granite-omnisearch-result']").length)){var l=a(".granite-omnisearch-form").serialize();
sessionStorage.setItem("omnisearch-csv-report.search-params",l);l=a("#omnisearch-csv-report");0>=l.length&&(a(".granite-omnisearch-overlay .granite-actionbar-right").prepend('\x3ca id\x3d"omnisearch-csv-report" class\x3d"foundation-collection-action" is\x3d"coral-anchorbutton" variant\x3d"quiet" icon\x3d"report" iconsize\x3d"S" data-foundation-collection-action\x3d"{\x26quot;target\x26quot;:\x26quot;.cq-siteadmin-admin-childpages\x26quot;,\x26quot;action\x26quot;:\x26quot;foundation.link\x26quot;,\x26quot;data\x26quot;:{\x26quot;href\x26quot;:\x26quot;/mnt/overlay/wcm/core/content/sites/createcsvexport.html{+id}?type\x3domnisearch\x26quot;,\x26quot;target\x26quot;:\x26quot;_blank\x26quot;},\x26quot;relScope\x26quot;:\x26quot;none\x26quot;}"\x3eCSV Report\x3c/a\x3e'),
l=a("#omnisearch-csv-report"));n?l.show():l.hide()}})})})(document,Granite,Granite.$);
(function(v,p,a){function w(){var b=0<a("#granite-omnisearch-result").size(),c=a(".granite-omnisearch-form");b?(c.submit(),0<a(".aem-configure-columns-dialog").length&&(a(".aem-configure-columns-dialog")[0].open=!1)):window.location.reload()}function u(){var b=a("#aem-configure-columns").find("coral-checkbox[checked]"),c=a(".aem-ColumnChooser").data("columnsCookie"),f="";if(c){for(var m=0;m<b.length;m++)f+=a(b[m]).val()+",";a.cookie(c.name,f,c)}}function q(){var b=H();return b&&0<b.length&&b.first().hasClass("foundation-layout-table")}
function k(b){var c=[];b=a(b||"#aem-configure-columns").find("coral-checkbox[checked]");for(var f=0;f<b.length;f++)c.push(a(b[f]).val());return c}function h(b,c){var f=a(".aem-configure-columns-dialog coral-dialog-header"),m=f.find("span");1>m.length&&(f.append("\x3cspan\x3e\x3c/span\x3e"),m=f.find("span"));m.html(" ("+b+"/"+c+")")}function n(){var b=a("#aem-configure-columns").find("coral-checkbox[checked]").length;a("#aem-configure-columns").find("coral-checkbox").each(function(c,f){c=a(f);b>=C?
c.get(0).checked?c.removeAttr("disabled"):c.attr("disabled","disabled"):c.removeAttr("disabled")})}function l(){var b=a("#aem-configure-columns").find(".manage-columns-for-path-container");0<a(".manage-columns-for-path-select").length&&Coral.commons.ready(a(".manage-columns-for-path-select")[0],function(){var c=a(".manage-columns-for-path-select").find("coral-select-item");b.toggle(c&&1<c.length)})}function g(b){a("#aem-configure-columns").closest(".aem-configure-columns-dialog").find(".aem-configure-columns-confirm")[0].disabled=
!b}function t(){var b=a("#aem-configure-columns").data("totalColumns");var c=a(".foundation-collection").first().width();isNaN(b)?(b=Math.floor(c/100)-2,2>b?b=2:7<b&&(b=7)):b=parseInt(b);return b}function D(){a("#aem-configure-columns").find("coral-checkbox").each(function(b){b=a(this);var c=b.closest("li");0<=a.inArray(b.val(),x)?(b.prop("checked",!0),c.addClass("selected")):(b.prop("checked",!1),c.removeClass("selected"))});C=t();g(!1);h(x.length,E);n()}function z(b){b=a(b.target);var c=a("#aem-configure-columns").find("coral-checkbox[checked]").length;
if(c>C&&c>x.length)return!1;var f=k(),m=!1;if(f.length!=x.length)m=!0;else for(var F=0;F<f.length;F++)if(0>a.inArray(f[F],x)){m=!0;break}g(m);b.closest("li").toggleClass("selected",b.is(":checked"));n();h(c,E)}function d(b){b=b.target.value;var c=a("#aem-configure-columns").find(".aem-ColumnChooser"),f=c.data("component-path");y.wait(c[0]);p.$.ajax({type:"GET",url:f+".html"+b,success:function(m,F,I){y.clearWait();a("#aem-configure-columns").find("[name\x3d'hasAnalyticsConfig']").remove();c.replaceWith(m);
a("#aem-configure-columns coral-checkbox").off("change").on("change",z);a(".aem-listview-remove-column").off("click").on("click",r);g(!1);G()},error:function(){y.notify("",p.I18n.get("Error occurred while loading configured columns."),"error");y.clearWait()}})}function e(b){p.$.ajax({type:"DELETE",url:b.configPath+"/jcr:content.customdata.config?metric\x3d"+b.metricId+"\x26contentpath\x3d"+b.contentPath,success:function(c,f,m){y.notify("",p.I18n.get("Successfully removed metric {0}.",b.metricId),
"success");c=b.$activator.closest("li");c.hasClass("selected")?(c.remove(),u(),w()):c.remove()},error:function(){y.notify("",p.I18n.get("Error occurred while removing custom metric {0}.",b.metricId),"error")}})}function r(b){b=a(b.target).closest("a");var c=a(".aem-ColumnChooser");b={configPath:c.data("analyticscfg"),contentPath:c.data("contentpath"),metricId:b.data("metric"),$activator:b};e(b)}function A(b){q()&&b.find("col").each(function(){a(this).get(0).hidden&&(a(this).get(0).hidden=!1,a(this).get(0).hidden=
!0)})}function B(){var b=a(".aem-configure-columns-dialog");0<b.length&&(Coral.commons.ready(b[0],function(){b[0].off("coral-overlay:beforeopen").on("coral-overlay:beforeopen",function(c){c.target===b[0]&&D()})}),0<a(".manage-columns-for-path-select").length&&Coral.commons.ready(a(".manage-columns-for-path-select")[0],function(){a(".manage-columns-for-path-select")[0].off("change").on("change",d)}),a("#aem-configure-columns coral-checkbox").off("change").on("change",z),a(".aem-listview-remove-column").off("click").on("click",
r),a(".aem-configure-columns-confirm").off("click").on("click",function(c){c.preventDefault();u();w();return!1}),a(".aem-add-custom-analytics-data").off("click").on("click",function(c){c.preventDefault();c=a(this).closest(".aem-configure-columns-dialog");0<c.length&&(c[0].open=!1)}))}function G(){var b=a("#aem-configure-columns");if(q()&&0!==b.length){C=t();E=b.find("coral-checkbox").length;x=k("#aem-configure-columns");b=b.find("coral-checkbox[checked]").length;h(b,E);if(q()){b=a("#aem-configure-columns").find(".aem-add-custom-analytics-data-container");
var c=a("[name\x3d'hasAnalyticsConfig']").val();b.toggle(c&&"true"==c)}l();n()}}function H(){var b=a("#granite-omnisearch-result");return 1===b.length?b:a(".foundation-collection")}var y=a(window).adaptTo("foundation-ui"),C=0,E=0,x=[];a(v).on("foundation-contentloaded",function(b){b=H();q()&&0!==a("#aem-configure-columns").length&&(G(),B());A(b)})})(document,Granite,Granite.$);
(function(v,p,a){function w(){var d=a(".foundation-collection");return 0<d.length&&d.first().hasClass("foundation-layout-table")}function u(){for(var d=[],e=a(".aem-custom-analytics-columns-dialog").find("[type\x3d'checkbox']:checked"),r=0;r<e.length;r++)d.push(a(e[r]).val());return d}function q(){a("input[name\x3d'customanalyticsdata']").each(function(e){e=a(this);e.prop("checked",0<=a.inArray(e.val(),D))});var d=a(".manage-columns-for-path-select")[0];d&&d.value!==z&&n()}function k(d){d.preventDefault();
d=a(d.target).closest(".aem-custom-analytics-columns-dialog").find("form");var e=d.find("[data-analyticscfg]"),r=e.data("analyticscfg");e=e.data("contentpath");p.$.ajax({type:"POST",url:r+"/jcr:content.customdata.config",data:d.serialize()+"\x26contentpath\x3d"+e,success:function(A,B,G){A=0<a(".cq-PredicateBreadcrumbs").length;B=a(".searchpanel");A?B.submit():window.location.reload()},error:function(){t.notify("",p.I18n.get("Error occurred while trying to save custom analytics data selection."),"error")}})}
function h(d){var e=a(".aem-AnalyticsMetrics");t.wait(e[0]);p.$.ajax({type:"GET",url:d,success:function(r,A,B){e.replaceWith(r);g()},error:function(){t.notify("",p.I18n.get("Error occurred while loading custom column data."))},always:function(){t.removeWait()}})}function n(){var d=a(".manage-columns-for-path-select")[0].value;var e=a(".aem-AnalyticsMetrics").data("component-path");e=/^(https?:)?\/\//i.test(e)?e.replace(/^(https?:)?\/\//i,""):e;h(e+".html"+d)}function l(){var d=a(".aem-custom-analytics-columns-dialog");
0<d.length&&(a(".aem-custom-analytics-columns-add-command").off("click").on("click",k),Coral.commons.ready(d[0],function(){d[0].off("coral-overlay:beforeopen").on("coral-overlay:beforeopen",function(e){e.target===d[0]&&q()})}))}function g(){w()&&(0<a(".manage-columns-for-path-select").length&&Coral.commons.ready(a(".manage-columns-for-path-select")[0],function(){z=a(".manage-columns-for-path-select")[0].value}),D=u())}var t=a(window).adaptTo("foundation-ui"),D=[],z="";a(v).on("foundation-contentloaded",
function(d){g();l()})})(document,Granite,Granite.$);