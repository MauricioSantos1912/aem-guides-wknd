(function(d,b){function g(){var a=b(".cq-common-admin-timeline-toolbar-actions-workflow-ok"),c=b(".cq-common-admin-timeline-toolbar-actions-workflow-form"),e=b.Event("before-timeline-workflow-actions");a.trigger(e);e.isDefaultPrevented()||a.hasClass("disabled")||(a=[],b(".cq-common-admin-timeline").data("paths")&&(a=b(".cq-common-admin-timeline").data("paths")),h(a,c))}function h(a,c){var e=c.serializeArray();k=a.length;for(var f=0;f<a.length;f++){if(!a[f]){b(".cq-common-admin-timeline-toolbar-actions-workflow").attr("hidden",
!0);return}e.push({name:"payload",value:a[f]})}b.ajax({url:c.attr("action"),type:c.attr("method")||"post",data:e,success:function(){c.find("input[type\x3dtext]").val("");l(!0)},error:function(){var m=Granite.UI.Foundation.Utils.sanitizeHtml(c.data("errormessage"));b(window).adaptTo("foundation-ui").notify("",m?Granite.I18n.getVar(m):Granite.I18n.get("Failed to create workflow"),"error");l(!1)}})}function l(a){1<k?(a&&b(window).adaptTo("foundation-ui").notify("",Granite.I18n.get("Workflows created for multiple items"),
"success"),hideActionButton()):(a&&b(window).adaptTo("foundation-ui").notify("",Granite.I18n.get("Workflow successfully created"),"success"),b(".cq-common-admin-timeline").trigger("cq-common-admin-timeline-change.cq-common-admin-timeline",{refresh:!0}))}function n(){var a=b(".cq-common-createworkflowdialog");0!==a.length&&a[0].hide();var c=[];b(".cq-siteadmin-admin-childpages.foundation-collection .foundation-collection-item.is-selected").each(function(){c.push(b(this).data("foundation-collection-item-id"))});
a=b(".cq-common-createworkflowdialog-form");h(c,a);a=b('.granite-toggleable-control [data-granite-toggleable-control-target*\x3d"timeline"]');0<a.length&&(a[0].selected=!0)}var k;b(d).on("change",".cq-common-admin-timeline-toolbar-actions-workflow-select",function(a){b(".cq-common-admin-timeline-toolbar-actions-workflow-ok")[0].disabled=!1});b(d).on("click.cq-common-admin-timeline-toolbar-actions-workflow",".cq-common-admin-timeline-toolbar-actions-workflow-ok",function(a){g()});b(d).on("submit",
".cq-common-admin-timeline-toolbar-actions-workflow-form",function(a){a.preventDefault();g()});b(d).on("click.cq-common-admin-timeline-toolbar-actions-workflow",".cq-common-createworkflowdialog-submit",function(a){n()});b(d).on("submit",".cq-common-createworkflowdialog-form",function(a){a.preventDefault();n()})})(document,Granite.$);