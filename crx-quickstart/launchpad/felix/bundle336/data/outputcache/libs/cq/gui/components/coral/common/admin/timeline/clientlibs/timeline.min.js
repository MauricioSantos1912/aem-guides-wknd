(function(g,a){a(g).on("click.cq-common-admin-timeline-toolbar",".cq-common-admin-timeline-toolbar-actions-button",function(d){var b=a(this).data("rel"),e=a("."+b),c=!0,f=a(".cq-common-admin-timeline");if(!checkIfKeypress(d))return!1;e.attr("hidden")||(c=!1,a(this).attr("aria-expanded",!1));a(".cq-common-admin-timeline-toolbar-actions").attr("hidden",!0);c&&"cq-common-admin-timeline-toolbar-actions-main"===b&&(a(this).attr("aria-expanded",!0),a("."+b).removeAttr("hidden"),a("."+b+" button:first-child").focus());
c&&"cq-common-admin-timeline-toolbar-actions-version"===b&&(a("."+b).removeAttr("hidden"),a("."+b+" div input[name\x3d'label']").focus());c&&"cq-common-admin-timeline-toolbar-actions-workflow"===b&&(a("."+b).removeAttr("hidden"),a("."+b+" button:first-child").focus());f.trigger("cq-common-admin-timeline-resize",{preserveScrollTop:!0})});checkIfKeypress=function(d){var b=d.y||d.clientY;return d.x||d.clientX||b?!0:!1};a(g).on("click.cq-common-admin-timeline-toolbar",".cq-common-admin-timeline-toolbar-actions-cancel",
function(d){hideActionButton()});hideActionButton=function(){var d=a(".cq-common-admin-timeline");a(".cq-common-admin-timeline-toolbar-actions").attr("hidden",!0);a("div#versionPopup").attr("aria-expanded",!1);d.trigger("cq-common-admin-timeline-resize",{preserveScrollTop:!0})};a(g).on("keypress.cq-common-admin-timeline-toolbar",".cq-common-admin-timeline-toolbar-actions-button",function(d){if(27===d.keyCode||13===d.keyCode||32===d.keyCode){d.stopPropagation();d.preventDefault();var b=a(this).data("rel"),
e=a("."+b),c=a(".cq-common-admin-timeline");e.attr("hidden");a(".cq-common-admin-timeline-toolbar-actions").attr("hidden",!0);a("div#versionPopup").attr("aria-expanded",!1);a("div#versionPopup").focus();takeKeyPressAction(d,b);c.trigger("cq-common-admin-timeline-resize",{preserveScrollTop:!0})}});takeKeyPressAction=function(d,b){13!==d.keyCode&&32!==d.keyCode||"cq-common-admin-timeline-toolbar-actions-main"!==b||(a("div#versionPopup").attr("aria-expanded",!0),a("."+b).removeAttr("hidden"),a("."+b+
" button:first-child").focus());13!==d.keyCode&&32!==d.keyCode||"cq-common-admin-timeline-toolbar-actions-version"!==b||(a("div#versionPopup").attr("aria-expanded",!0),a("."+b).removeAttr("hidden"),a("."+b+" div input[name\x3d'label']").focus());13!==d.keyCode&&32!==d.keyCode||"cq-common-admin-timeline-toolbar-actions-workflow"!==b||(a("div#versionPopup").attr("aria-expanded",!0),a("."+b).removeAttr("hidden"),a("."+b+" button:first-child").focus())};a(g).on("keypress.cq-common-admin-timeline-toolbar",
".cq-common-admin-timeline-toolbar-actions-cancel",function(d){if(13===d.keyCode||32===d.keyCode)hideActionButton(),a("div#versionPopup").focus()})})(document,Granite.$);
(function(g,a){function d(c,f,h){"label"===h||"comment"===h?c.stopPropagation():(f.hasClass("is-active")?(e(),f.find("section").attr("aria-expanded","false"),f.find("section").focus()):(e(),f.addClass("is-active"),f.find("section").attr("aria-expanded","true"),(c=f.find("form").find("input[type\x3d'text']"))&&0<c.length&&c[0].focus()),a(".cq-common-admin-timeline-toggleable").attr("hidden",!0))}function b(c){return a(".foundation-collection-item").filter(function(){return this.getAttribute("data-foundation-collection-item-id")===
c})}function e(){a(".cq-common-admin-timeline-event").removeClass("is-active")}a(g).on("click",".cq-common-admin-timeline-event",function(c){0<a(c.target).closest(".version-section-container").find("[iscurrentversion\x3d'true']").length||d(c,a(this),a(c.target).attr("name"))});a(g).on("keyup",".version-section:not([iscurrentversion\x3d'true'])",function(c){if(13===c.keyCode||32===c.keyCode||27===c.keyCode)c.stopPropagation(),27===c.keyCode?a(this).closest(".version-section-container").hasClass("is-active")&&
d(c,a(c.target).closest(".version-section-container"),""):d(c,a(c.target).closest(".version-section-container"),a(c.target).attr("name"))});a(g).on("keyup",".version-form-container",function(c){27===c.keyCode&&(c.stopPropagation(),d(c,a(c.target).closest(".version-section-container"),""))});a(g).on("click",".cq-common-admin-timeline-event a",function(c){c.stopPropagation()});a(g).on("click",".cq-common-admin-timeline-event button",function(c){c.stopPropagation()});a(g).on("click.cq-common-admin-timeline-toolbar-event",
".cq-common-admin-timeline-event-action-ok",function(c){c.stopPropagation();var f=a(this).closest("form");c=f.attr("action");var h=a('[name\x3d"path"]',f).val(),k=a('[name\x3d"collectionItemId"]',f).val(),m=f.data("disable");m&&a(m).attr("disabled",!0);-1!==c.indexOf("$resourcepath")&&(c=c.replace(/\$resourcepath/g,h),f.attr("action",c));a.ajax({url:encodeURIComponent(f.attr("action")).replace(/%2F/g,"/"),type:f.attr("method")||"post",data:f.serializeArray(),success:function(){var n=b(k?k:h).closest(".foundation-collection");
void 0!==n.adaptTo("foundation-collection")?n.adaptTo("foundation-collection").reload():a(".cq-common-admin-timeline-event").trigger("cq-common-admin-timeline-change.cq-common-admin-timeline-events");(n=f.data("successmessage"))&&a(window).adaptTo("foundation-ui").notify("",Granite.I18n.getVar(n),"success")},error:function(){var n=f.data("errormessage");a(window).adaptTo("foundation-ui").notify("",n?Granite.I18n.getVar(n):Granite.I18n.get("An error occured"),"error");f.closest(".cq-common-admin-timeline-event").hide()},
complete:function(){a(m).attr("disabled",!1)}})});a(g).on("keyup",".cq-common-admin-timeline-event",function(c){if(13===c.keyCode||32===c.keyCode||27===c.keyCode){c.stopPropagation();var f=a(c.target),h=a(this),k=h.closest(".version-section-container");f=f.attr("name");if("label"===f||"comment"===f){c.stopPropagation();return}27===c.keyCode&&h.hasClass("is-active")?(e(),a(h).children("section").attr("aria-expanded",!1)):h.hasClass("is-active")?(e(),a(h).children("section").attr("aria-expanded",!1)):
(e(),k.addClass("is-active"),k.children("section").attr("aria-expanded",!0))}a(".cq-common-admin-timeline-toggleable").attr("hidden",!0)})})(document,Granite.$);
(function(g,a){var d=[];a(g).on("cq-common-admin-timeline-change.cq-common-admin-timeline",".cq-common-admin-timeline",function(b,e){e=e||{};b=[];a(".cq-common-admin-timeline").data("paths")&&(b=a(".cq-common-admin-timeline").data("paths"));if(e.paths)d=e.paths;else if(e&&e.refresh)d=b;else if(a(".foundation-content-path").data("timeline")){var c=a(".foundation-content-path").data("foundation-content-path");c&&c.lastIndexOf("/")==c.length-1&&(c=c.substring(0,c.length-1));d=[c]}else d="";a(".cq-common-admin-timeline").data("paths",
d);!a(".cq-common-admin-timeline").is(":visible")||e.avoidRefresh||""===b&&0===d.length||(a(".cq-common-admin-timeline").hide(),a(this).trigger("cq-common-admin-timeline-change.cq-common-admin-timeline-items",e))})})(document,Granite.$);
(function(g,a){function d(){0<a(".cq-common-admin-timeline-events-end").length?a(".cq-common-admin-timeline-more").hide():(a(".cq-common-admin-timeline-more").show(),a(".cq-common-admin-timeline-more button").removeAttr("disabled"))}var b=0,e,c;a(g).on("cq-common-admin-timeline-change.cq-common-admin-timeline-items.cq-common-admin-timeline-events",".cq-common-admin-timeline",function(f,h){h=h||{};f=[];a(".cq-common-admin-timeline").data("paths")&&(f=a(".cq-common-admin-timeline").data("paths"));var k=
a(".cq-common-admin-timeline-filter");k.show();if(0===f.length||1===f.length&&""===f[0])a(".cq-common-admin-timeline-toolbar").hide(),a(".cq-common-admin-timeline-events").hide(),a(".cq-common-admin-timeline-state-empty").show().siblings().hide(),a(".cq-common-admin-timeline-more").hide(),a(".cq-common-admin-timeline-state").show();else if(1<f.length)a(".cq-common-admin-timeline-toolbar").show(),a(".cq-common-admin-timeline-events").hide(),a(".cq-common-admin-timeline-state-multi").show().siblings().hide(),
a(".cq-common-admin-timeline-more").hide(),a(".cq-common-admin-timeline-state").show();else{var m=!0;0<a(".foundation-selections-item coral-card").length&&(m=a(".foundation-selections-item coral-card").data("timeline"));if(m){a(".cq-common-admin-timeline-state").hide();a(".cq-common-admin-timeline-toolbar").show();a(".cq-common-admin-timeline-more button").attr("disabled","");b=h.append?b+1:0;e=a(".cq-common-admin-timeline-event").get(1);c=a(".cq-common-admin-timeline-event").get(a(".cq-common-admin-timeline-event").size()-
1);try{var n=new URL(a(".cq-common-admin-timeline-events").data("url"))}catch(p){n=null}a.ajax({url:null===n?a(".cq-common-admin-timeline-events").data("url"):encodeURIComponent(a(".cq-common-admin-timeline-events").data("url")),data:{item:f[0],filter:0<k.length?k[0].value:"",index:b,sort:a(".cq-common-admin-timeline-events").data("sort")||"asc"},cache:!1}).done(function(p){if(""===p)a(".cq-common-admin-timeline-toolbar").hide(),a(".cq-common-admin-timeline-events").hide(),a(".cq-common-admin-timeline-state-unavailable").show().siblings().hide(),
a(".cq-common-admin-timeline-state").hide(),k.hide();else{if(h.append){if("desc"==a(".cq-common-admin-timeline-events").data("sort")){var q=a(".cq-common-admin-timeline-scrollarea").scrollTop();a(".cq-common-admin-timeline-events").append(p)}else a(".cq-common-admin-timeline-events").prepend(p);d();a(".cq-common-admin-timeline-scrollarea").css("position","relative");if("desc"===a(".cq-common-admin-timeline-events").data("sort")){var l=a(c).nextAll();p=4>l.size()?l.size():4;l=l.get(p-1);l=a(l).position().top-
a(c).position().top;a(".cq-common-admin-timeline").trigger("cq-common-admin-timeline-resize",{scrollTop:q});a(".cq-common-admin-timeline-scrollarea").animate({scrollTop:q+l},400*p)}else q=a(e).position().top-a(".cq-common-admin-timeline-more").outerHeight(),l=a(e).prevAll(),p=4>l.size()?l.size():4,l=l.get(p-1),l=a(l).position().top,a(".cq-common-admin-timeline").trigger("cq-common-admin-timeline-resize",{scrollTop:q}),a(".cq-common-admin-timeline-scrollarea").animate({scrollTop:l},400*p)}else a(".cq-common-admin-timeline-toolbar-actions").attr("hidden",
!0),a(".cq-common-admin-timeline-events").html(p),d(),a(".cq-common-admin-timeline-events").show(),a(".cq-common-admin-timeline").trigger("cq-common-admin-timeline-resize",{scrollToBottom:!0});a(".cq-common-admin-timeline-events").trigger("foundation-contentloaded.foundation");a(".cq-common-admin-timeline-events").show()}}).fail(function(){a(".cq-common-admin-timeline-events").hide();a(".cq-common-admin-timeline-state-error").show().siblings().hide();a(".cq-common-admin-timeline-state").show()})}else a(".cq-common-admin-timeline-toolbar").hide(),
a(".cq-common-admin-timeline-events").hide(),a(".cq-common-admin-timeline-state-unavailable").show().siblings().hide(),a(".cq-common-admin-timeline-state").show()}})})(document,Granite.$);
(function(g,a){var d=Granite.I18n.get("An error occurred.");a(g).on("cq-common-admin-timeline-change.cq-common-admin-timeline-items.cq-common-admin-timeline-alerts",".cq-common-admin-timeline",function(b){b=[];a(".cq-common-admin-timeline").data("paths")&&(b=a(".cq-common-admin-timeline").data("paths"));0===b.length||1===b.length&&""===b[0]||1<b.length?(a(".cq-common-admin-timeline-alerts").html(""),a(".cq-common-admin-timeline-alerts").hide(),a(".cq-common-admin-timeline").trigger("cq-common-admin-timeline-resize")):
a.ajax({url:a(".cq-common-admin-timeline-alerts").data("url"),cache:!1,data:{item:b[0]}}).done(function(e){a(".cq-common-admin-timeline-alerts").html(e);a(".cq-common-admin-timeline-alerts").trigger("foundation-contentloaded.foundation");a(".cq-common-admin-timeline-alerts").show();a(".cq-common-admin-timeline").trigger("cq-common-admin-timeline-resize")}).fail(function(){a(".cq-common-admin-timeline-alerts").html(d);a(".cq-common-admin-timeline-alerts").hide()})})})(document,Granite.$);
(function(g,a,d){d(a).on("change",".cq-common-admin-timeline-filter",function(b){b.stopPropagation();d(".cq-common-admin-timeline-events").trigger("cq-common-admin-timeline-change.cq-common-admin-timeline-events");b={element:this.value,type:"select-item",action:"change",widget:{name:"timeline filter",type:"select"},feature:"aem:timeline"};d(g).adaptTo("foundation-tracker").trackEvent(b)})})(window,document,Granite.$);
(function(g,a){a(g).on("click.cq-common-admin-timeline-toolbar",".cq-common-admin-timeline-more button",function(d){a(this).trigger("cq-common-admin-timeline-change.cq-common-admin-timeline-items",{append:!0})})})(document,Granite.$);
(function(g,a){a(g).on("foundation-contentloaded.cq-common-admin-timeline",function(d,b){var e=a(".cq-common-admin-timeline");d="."+e.data("foundationCollectionRel")||"";var c=a(d+".foundation-collection");window.setTimeout(function(){var f=0,h=c.adaptTo("foundation-selections");h&&(f=h.count());0===c.length||0<f||e.trigger("cq-common-admin-timeline-change.cq-common-admin-timeline",b)},1)})})(document,Granite.$);
(function(g,a,d){d(g).on("foundation-selections-change",function(b){b=d(b.target);if(!b.is(".foundation-layout-card")||b.is(".mode-selection"))if(b=b.find(".foundation-selections-item"),0===b.length)d(".cq-common-admin-timeline").trigger("cq-common-admin-timeline-change.cq-common-admin-timeline",{paths:[]});else{var e=[];b.each(function(){e.push(d(this).data("foundation-collection-item-id"))});b=[];d(".cq-common-admin-timeline").data("paths")&&(b=d(".cq-common-admin-timeline").data("paths"));d(".cq-common-admin-timeline").trigger("cq-common-admin-timeline-change.cq-common-admin-timeline",
{paths:e,avoidRefresh:1<e.length&&1<b.length})}})})(document,Granite,Granite.$);
(function(g,a){a(g).on("cq-common-admin-timeline-resize",".cq-common-admin-timeline",function(d,b){b=b||{};a(".cq-common-admin-timeline").fadeIn("fast");d=a(".cq-common-admin-timeline-scrollarea");var e=d.scrollTop(),c=a(".cq-common-admin-timeline-toolbar");if(0!==d.offset().top){c.css("position","absolute");var f=c.outerHeight();c.css("position","static");d.height(a(window).height()-d.offset().top-f);b.scrollTop?d.scrollTop(b.scrollTop):b.scrollToBottom?d.scrollTop(d.get(0).scrollHeight):b.preserveScrollTop&&
d.scrollTop(e)}});a(window).on("resize",function(d){a(".cq-common-admin-timeline").trigger("cq-common-admin-timeline-resize")})})(document,Granite.$);
(function(g,a){function d(){var b=a(".cq-common-admin-timeline");if(0<b.length)if(void 0===b.data("paths")){var e=[],c="."+b.data("foundationCollectionRel")||"";a(c).find(".foundation-collection-item.is-selected").each(function(){e.push(a(this).data("foundation-collection-item-id"))});b.trigger("cq-common-admin-timeline-change.cq-common-admin-timeline",{paths:e})}else b.trigger("cq-common-admin-timeline-change.cq-common-admin-timeline-items");else window.setTimeout(d,10)}a(g).on("foundation-toggleable-show",
function(b){a(b.target).hasClass("cq-rail-timeline")&&d()})})(document,Granite.$);(function(g,a){a(g).adaptTo("foundation-registry").register("foundation.adapters",{type:"cq-timeline",selector:".cq-common-admin-timeline",adapter:function(d){return{filter:function(b){b=b||"all";var e=d.querySelector(".cq-common-admin-timeline-filter");e&&(e=e.items.getAll().find(function(c){return c.value===b}))&&(e.selected=!0)}}}})})(window,Granite.$);
(function(g,a){function d(e,c){var f=a(e,c);if(f.length)return a.when(f);var h=a.Deferred(),k=setInterval(function(){var m=a(e,c);m.length&&(clearInterval(k),h.resolve(m))},50);setTimeout(function(){clearInterval(k);h.reject()},1E3);return h.promise()}function b(e,c){e.adaptTo("cq-timeline").filter(c)}a(g).on("click",".cq-timeline-control",function(e){e.preventDefault();e.stopPropagation();e=a(this);var c=e[0].dataset.cqTimelineControlFilter,f=e.closest(".foundation-collection-item"),h=f.closest(".foundation-collection").adaptTo("foundation-selections");
h.clear();if(e=g.querySelector(".cq-rail-timeline")){var k=e.dataset.shellCollectionpageRailPanel,m=a(".cq-common-admin-timeline",e);m.length?(b(m,c),h.select(f[0])):d(".cq-common-admin-timeline",e).then(function(n){b(n,c);h.select(f[0])});a("#shell-collectionpage-rail-toggle \x3e coral-cyclebutton-item").filter(function(){return this.dataset.graniteToggleableControlName===k}).prop("selected",!0)}})})(document,Granite.$);