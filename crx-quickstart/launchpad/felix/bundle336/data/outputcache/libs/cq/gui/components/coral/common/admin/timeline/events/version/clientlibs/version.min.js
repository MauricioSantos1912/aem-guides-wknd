(function(f,c){function l(){var a=[];c(".cq-common-admin-timeline").data("paths")&&(a=c(".cq-common-admin-timeline").data("paths"));var b=c(".cq-common-admin-timeline-toolbar-actions-version-form");m(a,b)}function m(a,b){var d=b.attr("action"),e=a.length;if(1===e&&""===a[0])c(".cq-common-admin-timeline-toolbar-actions-version").attr("hidden",!0);else{b.find("[name\x3d'path']").remove();for(var k=0;k<e;k++){var h=a[k];-1!==d.indexOf("$resourcepath")&&(h="/"===d.charAt(d.indexOf("$resourcepath")-1)?
d.replace(/\/\$resourcepath/g,h):d.replace(/\$resourcepath/g,h));c("\x3cinput\x3e\x3c/input\x3e").attr("type","hidden").attr("name","path").attr("value",h).appendTo(b)}r(b,d,e);b.find("input[is\x3d'coral-textfield']")[0].value=""}}function r(a,b,d){a&&c.ajax({url:encodeURIComponent(b).replace(/%2F/g,"/"),type:a.attr("method")||"post",data:a.serializeArray(),success:function(e){n(a,d,e)},error:function(e){n(a,d,e,!0)}})}function n(a,b,d,e){!b||1>b||(e&&(a=a.data("errormessage"),d=c(d.responseText).find("#Message"),
d.length&&(a=d[0].innerText),g.notify("",a?Granite.I18n.getVar(a):Granite.I18n.get("Failed to create version"),"error")),1<b?(e||g.notify("",Granite.I18n.get("Versions created for multiple items"),"success"),hideActionButton()):(e||g.notify("",Granite.I18n.get("Version successfully created"),"success"),c(".cq-common-admin-timeline-events").trigger("cq-common-admin-timeline-change.cq-common-admin-timeline-events")))}function p(a,b){b?(a=window.open(Granite.HTTP.externalize(a+".html")),c(".cq-common-admin-timeline-events").trigger("cq-common-admin-timeline-preview-opened.cq-common-admin-timeline-events",
a)):g.alert(Granite.I18n.get("Preview"),Granite.I18n.get("Failed to preview version"),"error")}function q(a,b,d,e){e?window.document.location.href=Granite.HTTP.externalize("/mnt/overlay/wcm/core/content/sites/diffresources.html"+a+"?item\x3d"+d+"\x26sideBySide\x26versionId\x3d"+b):(a=d.responseText?Granite.I18n.get(d.responseText):Granite.I18n.get("Failed to compare version"),g.alert(Granite.I18n.get("Preview"),a,"error"))}var g=c(window).adaptTo("foundation-ui");c(f).on("click.cq-common-admin-timeline-toolbar-actions-version",
".cq-common-admin-timeline-toolbar-actions-version-ok",function(a){l()});c(f).on("submit",".cq-common-admin-timeline-toolbar-actions-version-form",function(a){a.preventDefault();l()});c(f).on("click.cq-common-admin-timeline-events",".cq-common-admin-timeline-preview-button",function(a){(a=c(a.currentTarget).data("vid"))&&c.ajax({url:Granite.HTTP.externalize("/mnt/overlay/wcm/core/content/sites/versionhistory/_jcr_content.txt"),type:"post",dataType:"text",data:{versionId:a,wcmmode:"disabled"},success:function(b){p(b,
!0)},error:function(b){p(b,!1)}})});c(f).on("click.cq-common-admin-timeline-events",".cq-common-admin-timeline-compare-button",function(a){var b=c(a.currentTarget).data("vid"),d=c(a.currentTarget).data("path");b&&d&&c.ajax({url:Granite.HTTP.externalize("/mnt/overlay/wcm/core/content/sites/versionhistory/_jcr_content.txt"),type:"post",dataType:"text",data:{versionId:b,wcmmode:"disabled"},success:function(e){q(d,b,e,!0)},error:function(e){q(d,b,e,!1)}})});c(f).on("click.cq-common-admin-timeline-toolbar-actions-version",
".cq-common-createversiondialog-submit",function(a){var b=[];c(".cq-siteadmin-admin-childpages.foundation-collection .foundation-collection-item.is-selected").each(function(){b.push(c(this).data("foundation-collection-item-id"))});a=c(".cq-common-createversiondialog-form");submitDialog(".cq-common-createversiondialog",b,a)});submitDialog=function(a,b,d){a=c(a);0!==a.length&&a[0].hide();m(b,d);b=c('coral-cyclebutton-item[data-granite-toggleable-control-name\x3d"timeline"]');0<b.length&&(b[0].selected=
!0)}})(document,Granite.$);